<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" href="./assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" href="./assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" href="./assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <link rel="manifest" href="./manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        resizeObserver.observe(obj.contentWindow.document.body);
      }
    </script>
    <marimo-filename hidden>notebook.py</marimo-filename>
    <marimo-mode data-mode='read' hidden></marimo-mode>
    <marimo-version data-version='0.11.22' hidden></marimo-version>
    <marimo-user-config data-config='{"completion": {"activate_on_typing": true, "copilot": false}, "display": {"dataframes": "rich", "cell_output": "above", "theme": "light", "default_width": "medium", "code_editor_font_size": 14}, "formatting": {"line_length": 79}, "keymap": {"preset": "default", "overrides": {}}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "on_cell_change": "autorun", "watcher_on_save": "lazy", "output_max_bytes": 8000000, "std_stream_max_bytes": 1000000, "pythonpath": []}, "save": {"autosave": "off", "autosave_delay": 1000, "format_on_save": false}, "package_management": {"manager": "pip"}, "server": {"browser": "default", "follow_symlink": false}, "language_servers": {"pylsp": {"enabled": true, "enable_mypy": true, "enable_ruff": true, "enable_flake8": false, "enable_pydocstyle": false, "enable_pylint": false, "enable_pyflakes": false}}, "snippets": {"custom_paths": [], "include_default_snippets": true}}' data-overrides='{}' hidden></marimo-user-config>
    <marimo-app-config data-config='{"width": "compact"}' hidden></marimo-app-config>
    <marimo-server-token data-token='123' hidden></marimo-server-token>
    <title>LightwaveExplorerDocumentation</title>
    <script type="module" crossorigin src="./assets/index-C_DVbbN-.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-Dx2fXC3c.css">
  <marimo-wasm hidden=""></marimo-wasm>
    <script>
        if (window.location.protocol === 'file:') {
            alert('Warning: This file must be served by an HTTP server to function correctly.');
        }
    </script>
    
    <style>
        #save-button {
            display: none !important;
        }
        #filename-input {
            display: none !important;
        }
    </style>
    <marimo-code hidden="" data-show-code="false">import%20marimo%0A%0A__generated_with%20%3D%20%220.11.22%22%0Aapp%20%3D%20marimo.App()%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%23%20Lightwave%20Explorer%0A%20%20%20%20%20%20%20%20Nick%20Karpowicz%2C%20Max%20Planck%20Institute%20of%20Quantum%20Optics%0A%0A%20%20%20%20%20%20%20%20!%5BLightwave%20Explorer%20icon%5D(https%3A%2F%2Fraw.githubusercontent.com%2FNickKarpowicz%2FLightwaveExplorer%2Frefs%2Fheads%2Fmaster%2FSource%2FBuildResources%2FIcon.svg)%0A%0A%20%20%20%20%20%20%20%20Thanks%20for%20using%20LWE%20and%20reading%20the%20manual!%20This%20Marimo%20(Python)%20notebook%20contains%20background%20on%20the%20physical%20system%20that%20is%20actually%20being%20solved%20in%20the%20simulation%2C%20and%20instructions%20on%20how%20to%20interact%20with%20it%20in%20the%20software.%20There%20are%20some%20interactive%20plots%20that%20let%20you%20see%20how%20some%20of%20the%20internals%20work%3A%20if%20you%20want%20to%20see%20the%20code%20used%20to%20generate%20the%20plots%2C%20hit%20the%20%22...%22%20button%20in%20the%20corner%20and%20select%20%22Show%20code%22.%0A%0A%20%20%20%20%20%20%20%20Please%20let%20me%20know%20if%20something%20you%20want%20to%20know%20about%20is%20missing%20-%20this%20documentation%20is%20still%20incomplete%20(since%20the%20thing%20its%20describing%20is%20still%20a%20moving%20target)%20but%20I'm%20happy%20to%20help%20out%20if%20you%20have%20questions.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%23%23%23%20Physical%20model%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%23%23%20Basic%20equations%3A%20The%20unidirectional%20propagation%20equation%0A%20%20%20%20%20%20%20%20I'm%20sure%20we've%20all%20derived%20the%20wave%20equation%20from%20Maxwell's%20equations%20before%2C%20so%20I'm%20not%20going%20to%20repeat%20that.%20Let's%20just%20talk%20about%20the%20equations%20I'm%20using%20and%20where%20they%20come%20from.%0A%0A%20%20%20%20%20%20%20%20In%20LWE%2C%20there%20are%20two%20modes%20of%20propagation.%20The%20most%20commonly-used%20is%20the%20nonlinear%2C%20unidirectional%20wave%20equation%2C%20which%20has%20a%20typical%20form%20like%20this%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20z%7D%20E(%5Cmathbf%7Bx%7D%20%2C%5Comega)%20%3D%20i(k%20%2B%20%5Cfrac%7B1%7D%7B2k%7D%5Cnabla%5E2_%5Cperp)E(%5Cmathbf%7Bx%7D%20%2C%5Comega)%20%2B%20%5Cfrac%7Bi%5Comega%7D%7B2%5Cepsilon_0%20%5Ctilde%7Bn%7D%5Cleft(%5Comega%5Cright)c%7D%5Cmathbf%7BP%7D%5E%7B%5Cmathrm%7BNL%7D%7D%5Cleft(%5Cmathbf%7Bx%7D%2C%5Comega%5Cright)%5Ctag%7B1%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20where%20propagation%20of%20the%20field%20is%20assumed%20to%20be%20primarily%20along%20the%20%24z%24%20axis.%20%24%5Cnabla%5E2_%5Cperp%24%20is%20the%20transverse%20Laplacian%20(_e.g._%20%24%5Cfrac%7B%5Cpartial%5E2%7D%7B%5Cpartial%20x%5E2%7D%20%2B%20%5Cfrac%7B%5Cpartial%5E2%7D%7B%5Cpartial%20y%5E2%7D%24%20in%20Cartesian%20coordinates).%20%24%5Comega%24%20is%20the%20angular%20frequency%20(this%20equation%20is%20in%20the%20frequency%20domain)%2C%20%24%5Cmathbf%7BP%7D%5E%7BNL%7D%24%20is%20the%20nonlinear%20polarization%2C%20%24%5Ctilde%7Bn%7D%24%20is%20the%20complex%20index%20of%20refraction%2C%20and%20the%20other%20constants%20have%20their%20usual%20definition.%20Bold%20%24%5Cmathbf%7Bx%7D%24%20is%20shorthand%20for%20either%20%24x%24%2C%20%24y%24%2C%20and%20%24z%24%20in%20Cartesian%20coordinates%2C%20or%20%24%5Crho%24%2C%20%24%5Ctheta%24%2C%20and%20%24z%24%20in%20cylindrical%20coordinates.%0A%0A%20%20%20%20%20%20%20%20In%20deriving%20this%20equation%2C%20we%20make%20the%20assumption%20that%20%24%5Cleft%7Ck_z%5E2%5Cright%7C%20%5Cgg%20%5Cleft%7C%5Cfrac%7B%5Cpartial%5E2%7D%7B%5Cpartial%20z%5E2%7D%20%5Ctilde%7BA%7D(z)%5Cright%7C%24%2C%20where%20%24%5Ctilde%7BA%7D%24%20is%20the%20complex%20amplitude%20of%20a%20given%20frequency%20component%20of%20the%20electric%20field.%20This%20means%20that%20we%20are%20assuming%20that%20the%20field%20evolves%20gradually%20on%20the%20spatial%20scale%20of%20the%20wavelength.%20This%20is%20a%20good%20assumption%20when%20the%20light%20is%20propagating%20in%20the%20presence%20of%20%22normal%22%20nonlinearities%2C%20where%20the%20nonlinear%20signal%20builds%20up%20slowly%20over%20time.%20It's%20not%20a%20good%20assumption%20near%20interfaces%2C%20where%20the%20reflection%20from%20the%20surface%20suddenly%20changes%20the%20evolution%20of%20the%20wave%2C%20and%20there%20is%20a%20counterpropagting%20wave.%20So%2C%20for%20thin%20crystals%2C%20or%20surface%20nonlinearities%2C%20we'll%20want%20to%20fully%20solve%20Maxwell's%20equations.%20You'll%20notice%20that%20the%20spatial%20form%20of%20this%20equation%20looks%20like%20the%20Helmholtz%20equation.%20The%20underlying%20assumptions%20are%20quite%20similar.%0A%0A%20%20%20%20%20%20%20%20If%20%24%5Cmathbf%7BP%7D%5E%7BNL%7D%20%3D%200%24%2C%20we%20have%20linear%20propagation%20of%20light%2C%20and%20for%20example%20a%20Gaussian%20beam%20is%20a%20solution%20to%20the%20above%20equation.%20When%20it's%20nonzero%20is%20when%20things%20get%20interesting.%20We'll%20go%20over%20how%20that%20happens%20in%20a%20bit.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20Basic%20equations%3A%20Finite-difference%20time-domain%20(FDTD)%0A%0A%20%20%20%20%20%20%20%20The%20other%20propagation%20mode%20we%20can%20use%20is%20FDTD%20mode%2C%20where%20Maxwell's%20equations%20are%20solved%20on%20a%20grid.%20This%20mode%20doesn't%20use%20the%20paraxial%20or%20slowly-evolving%20wave%20equations%20used%20in%20the%20unidirectional%20propagation%20equation%20above.%20This%20gives%20us%20a%20few%20things%3A%20effects%20at%20interfaces%20are%20handled%20more%20correctly%2C%20and%20we%20can%20simulate%20etalon%20effects%20inside%20of%20crystals%20(where%20the%20light%20makes%20multiple%20reflections%20inside%2C%20resulting%20in%20a%20modulated%20transmission%20vs.%20frequency).%0A%0A%20%20%20%20%20%20%20%20For%20this%20mode%2C%20we%20don't%20need%20to%20derive%20much%2C%20we%20just%20start%20with%20two%20equations%20from%20Maxwell.%20Specifically%2C%0A%0A%20%20%20%20%20%20%20%20Faraday's%20law%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cnabla%20%5Ctimes%20%5Cmathbf%7BE%7D%3D-%5Cfrac%7B%5Cpartial%20%5Cmathbf%7BB%7D%7D%7B%5Cpartial%20t%7D%5Ctag%7B2%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20and%20Ampere's%20law%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cnabla%20%5Ctimes%20%5Cmathbf%7BB%7D%20%3D%20%5Cmu_0%20%5Cleft(%5Cmathbf%7BJ%7D%20%2B%20%5Cepsilon_0%5Cfrac%7B%5Cpartial%5Cmathbf%7BE%7D%7D%7B%5Cpartial%20t%7D%5Cright)%5Ctag%7B3%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20These%20are%20just%20two%20coupled%20first-order%20partial%20differential%20equations.%20We%20have%20both%20quantities%20%24%5Cmathbf%7BE%7D%24%20and%20%24%5Cmathbf%7BB%7D%24%20definied%20on%20a%20grid%20in%20space%2C%20and%20these%20quantities%20advance%20over%20time.%20If%20something%20interesting%20is%20happening%2C%20there%20will%20also%20be%20a%20material%2C%20whose%20response%20to%20the%20field%20is%20%24%5Cmathbf%7BJ%7D%24.%20The%20physical%20model%20in%20the%20basic%20version%20of%20LWE%20for%20calculating%20the%20current%20is%20in%20the%20form%20of%20a%20series%20of%20Lorentzian%20oscillators.%20Their%20basic%20equations%20of%20motion%20look%20like%20this%20when%20we're%20dealing%20with%20the%20linear%20response%3A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cfrac%7B%5Cpartial%20%5Cmathbf%7BJ%7D%7D%7B%5Cpartial%20t%7D%20%3D%20k_L%20%5Cmathbf%7BE%7D%20-%20%5Cgamma%20%5Cmathbf%7BJ%7D%20-%20%5Comega_0%5E2%20%5Cmathbf%7BP%7D%5Ctag%7B4%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cfrac%7B%5Cpartial%5Cmathbf%7BP%7D%7D%7B%5Cpartial%20t%7D%20%3D%20%5Cmathbf%7BJ%7D%5Ctag%7B5%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20where%20%24k_L%20%3D%20%5Cfrac%7BNe%5E2%7D%7Bm_e%7D%24%20is%20the%20strength%20of%20the%20response%20depending%20of%20the%20density%20of%20dipoles%20N%20and%20their%20charge%20and%20mass%2C%20%24%5Cgamma%24%20describes%20the%20relaxation%20rate%20of%20the%20oscillator%20and%20%24%5Comega_0%24%20is%20its%20resonance%20frequency.%20So%20now%20we%20have%20two%20more%20coupled%2C%20first-order%20partial%20differential%20equations.%20Since%20the%20first%20one%20contains%20%24%5Cmathbf%7BE%7D%24%20as%20a%20driving%20term%2C%20inside%20of%20the%20material%2C%20all%20of%20our%20equations%20are%20coupled%20together!%20When%20we%20start%20doing%20nonlinear%20optics%2C%20we%20just%20have%20to%20modify%20the%20driving%20term%20to%20make%20use%20of%20the%20nonlinear%20tensor%20(plus%20some%20additional%20bookkeeping%20if%20we're%20modeling%20the%20material's%20response%20with%20an%20instantaneous%20component).%0A%0A%20%20%20%20%20%20%20%20You%20can%20see%20that%20there%20are%20more%20quantities%20to%20take%20care%20of%20when%20we%20solve%20Maxwell's%20equations%20for%20our%20field.%20Even%20if%20we%20only%20want%20%24%5Cmathbf%7BE%7D%24%2C%20we%20also%20have%20to%20keep%20track%20of%20%24%5Cmathbf%7BB%7D%24%2C%20as%20well%20as%20%24%5Cmathbf%7BJ%7D%24%20and%20%24%5Cmathbf%7BP%7D%24%20for%20*each*%20resonance%20that%20makes%20up%20the%20material%20response.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%23%20Linear%20crystal%20properties%0A%0A%20%20%20%20%20%20%20%20For%20every%20material%20we're%20going%20to%20deal%20with%2C%20we%20need%20to%20have%20a%20way%20of%20describing%20its%20refractive%20index.%20This%20is%20typically%20done%20with%20a%20parameterized%20equation%20known%20generally%20as%20a%20Sellmeier%20equation.%20There%20are%20many%20different%20forms%20of%20this%20that%20you'll%20find%20in%20literature.%20So%20far%2C%20I've%20only%20implemented%20two%20of%20them%20here%3A%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20General%20fitting%20sellmeier%20equation%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20n%5E2%20%3D%20a%5B0%5D%20%2B%20%5Cfrac%7Ba%5B1%5D%20%2B%20a%5B2%5D%5Clambda%5E2%7D%7B%5Clambda%5E2%20%2B%20a%5B3%5D%7D%20%2B%20%5Cfrac%7Ba%5B4%5D%20%2B%20a%5B5%5D%5Clambda%5E2%7D%7B%5Clambda%5E2%20%2B%20a%5B6%5D%7D%20%2B%20%5Cfrac%7Ba%5B7%5D%20%2B%20a%5B8%5D%5Clambda%5E2%7D%7B%5Clambda%5E2%20%2B%20a%5B9%5D%7D%20%2B%20%5Cfrac%7Ba%5B10%5D%20%2B%20a%5B11%5D%5Clambda%5E2%7D%7B%5Clambda%5E2%20%2B%20a%5B12%5D%7D%20%2B%20a%5B13%5D%20%5Clambda%5E2%20%2B%20a%5B14%5D%20%5Clambda%5E4%20%2B%20a%5B15%5D%20%5Clambda%5E6%20%2B%20%5Cfrac%7Bk%20a%5B16%5D%7D%7Ba%5B17%5D%20-%20%5Comega%5E2%20%2B%20i%20a%5B18%5D%5Comega%7D%20%2B%20%5Cfrac%7Bk%20a%5B19%5D%7D%7Ba%5B20%5D%20-%20%5Comega%5E2%20%2B%20i%20a%5B21%5D%5Comega%7D%20%5Ctag%7B6%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20There%20are%20quite%20a%20few%20terms.%20You're%20not%20expected%20to%20use%20all%20of%20them%2C%20they're%20just%20there%20to%20make%20it%20more%20likely%20that%20it%20can%20accommodate%20any%20equation%20you%20find%20in%20literature%2C%20containing%20common%20forms%20of%20various%20elements.%20And%20terms%20not%20present%2C%20you%20can%20just%20set%20the%20top%20value%20to%20zero.%20The%20constant%20%24k%20%3D%20%5Cfrac%7Be%5E2%7D%7B%5Cepsilon_0%20m_e%7D%24%20has%20a%20value%20of%20about%203182.6%20in%20SI%20units.%20The%20last%20two%20terms%20are%20complex%20valued%3B%20this%20allows%20you%20to%20add%20absorption%2C%20with%20a%20Lorentzian%20line%20shape.%0A%0A%20%20%20%20%20%20%20%20Let's%20look%20at%20a%20concrete%20example.%20The%20sliders%20below%20will%20let%20you%20change%20the%20values%20of%20a%5B3%5D%20and%20a%5B6%5D%2C%20adjusting%20the%20positions%20of%20the%20UV%20and%20IR%20resonances.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20%23Slider%20to%20control%20the%20UV%20resonance%0A%20%20%20%20UV%20%3D%20mo.ui.slider(start%3D0.5%2C%20stop%3D2.0%2C%20step%3D0.1%2C%20value%3D1%2C%20label%3D%22UV%20factor%22)%0A%20%20%20%20UV%0A%20%20%20%20return%20(UV%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20%23Slider%20to%20control%20the%20IR%20resonance%0A%20%20%20%20IR%20%3D%20mo.ui.slider(start%3D0.5%2C%20stop%3D2.0%2C%20step%3D0.1%2C%20value%3D1%2C%20label%3D%22IR%20factor%22)%0A%20%20%20%20IR%0A%20%20%20%20return%20(IR%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(IR%2C%20UV%2C%20mo)%3A%0A%20%20%20%20%23importing%20some%20modules%20I'll%20want%0A%20%20%20%20import%20LightwaveExplorer%20as%20lwe%0A%20%20%20%20import%20io%0A%20%20%20%20import%20numpy%20as%20np%0A%20%20%20%20import%20matplotlib.pyplot%20as%20plt%0A%20%20%20%20from%20matplotlib%20import%20rcParams%0A%20%20%20%20rcParams%5B'font.family'%5D%20%3D%20'sans-serif'%0A%20%20%20%20rcParams%5B'font.sans-serif'%5D%20%3D%20%5B'Helvetica'%2C%20'Arial'%2C%20'Verdana'%2C%20'DejaVu%20Sans'%2C%20'Liberation%20Sans'%2C%20'Bitstream%20Vera%20Sans'%2C%20'sans-serif'%5D%0A%0A%0A%20%20%20%20def%20showmo()%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Helper%20function%20to%20plot%20as%20an%20svg%20and%20have%20it%20display%20in%20marimo%20in%20vector%20form%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20svg_buffer%20%3D%20io.StringIO()%0A%20%20%20%20%20%20%20%20plt.savefig(svg_buffer%2C%20format%3D'svg')%0A%20%20%20%20%20%20%20%20svg_buffer.seek(0)%0A%20%20%20%20%20%20%20%20svg_data%20%3D%20svg_buffer.getvalue()%0A%20%20%20%20%20%20%20%20return%20mo.Html(svg_data)%0A%0A%20%20%20%20%23first%20we'll%20make%20a%20wavelength%20grid%20to%20work%20with%0A%20%20%20%20l%20%3D%20np.linspace(0.3%2C3%2C1024)%0A%0A%20%20%20%20%23next%20we'll%20need%20Sellmeier%20coefficients%2C%20these%20are%20for%20barium%20fluoride%2C%20H.%20H.%20Li.%2C%20J.%20Phys.%20Chem.%20Ref.%20Data%209%2C%20161-289%20(1980)%0A%20%20%20%20a%20%3D%20np.array(%5B1.33973%2C0%2C0.81070%2C-0.010130%2C0%2C0.19652%2C-892.22%2C0%2C4.52469%2C-2896.6%2C0%2C0%2C1%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D)%0A%0A%20%20%20%20%23we%20can%20get%20the%20refractive%20index%20for%20the%20wavelengths%20we%20put%20in%20the%20grid%20by%20calling%20the%20sellmeier()%20function%0A%20%20%20%20%23from%20the%20lightwaveExplorer%20module%2C%20with%20the%20equationType%20set%20to%200.%0A%20%20%20%20n%20%3D%20lwe.sellmeier(l%2C%20a%2C%200)%0A%0A%20%20%20%20%23let's%20make%20it%20so%20we%20can%20adjust%20the%20resonances%20of%20the%20oscillators%20and%20see%20how%20it%20affects%20the%20index%0A%0A%20%20%20%20fig%2Cax%20%3D%20plt.subplots(1%2C1%2C%20figsize%3D(5%2C4))%0A%20%20%20%20a2%20%3D%20np.array(%5B1.33973%2C0%2C0.81070%2C-0.010130%2C0%2C0.19652%2C-892.22%2C0%2C4.52469%2C-2896.6%2C0%2C0%2C1%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D)%0A%20%20%20%20a2%5B3%5D%20*%3D%20UV.value%0A%20%20%20%20a2%5B6%5D%20*%3D%20IR.value%0A%20%20%20%20n2%20%3D%20lwe.sellmeier(l%2C%20a2%2C%200)%0A%20%20%20%20ax.plot(l%2Cnp.real(n)%2Clabel%3D%22original%22%2Ccolor%3D%22blue%22)%0A%20%20%20%20ax.plot(l%2Cnp.real(n2)%2C%20label%20%3D%20%22modified%22%2C%20color%20%3D%20%22magenta%22)%0A%20%20%20%20ax.set_xlabel(%22Wavelength%20(microns)%22)%0A%20%20%20%20ax.set_ylabel(%22n%22)%0A%20%20%20%20ax.legend()%0A%20%20%20%20showmo()%0A%20%20%20%20return%20a%2C%20a2%2C%20ax%2C%20fig%2C%20io%2C%20l%2C%20lwe%2C%20n%2C%20n2%2C%20np%2C%20plt%2C%20rcParams%2C%20showmo%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20You%20can%20play%20with%20the%20position%20of%20the%20resonances%20and%20see%20how%20this%20affects%20the%20value%20of%20the%20refractive%20index%2C%20and%20its%20dispersion.%20Feel%20free%20to%20add%20sliders%20or%20attach%20them%20to%20other%20parameters%20to%20see%20what%20they%20do.%20Using%20the%20function%20above%2C%20you%20can%20use%20a%20fitting%20routine%20to%20get%20coefficients%20in%20the%20appropriate%20format%20if%20there%20isn't%20a%201-to-1%20mapping%20from%20literature%20to%20the%20equation.%0A%0A%20%20%20%20%20%20%20%20Another%20equation%20that's%20implemented%20in%20the%20code%20is%20all%20Lorentzians%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20n%5E2%20%3D%20a%5B0%5D%20%2B%20%5Cfrac%7Bk%20a%5B1%5D%7D%7Ba%5B2%5D%20-%20%5Comega%5E2%20%2B%20i%20a%5B3%5D%5Comega%7D%20%2B%20%5Cfrac%7Bk%20a%5B4%5D%7D%7Ba%5B5%5D%20-%20%5Comega%5E2%20%2B%20i%20a%5B6%5D%5Comega%7D%20%2B%20...%20%5Ctag%7B7%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20all%20the%20way%20up%20to%20%24a%5B21%5D%24.%0A%0A%20%20%20%20%20%20%20%20This%20one%20is%20required%20for%20FDTD%3A%20it%20is%20simply%20the%20response%20of%20a%20collection%20of%20Lorentzian%20oscillators%2C%20and%20obeys%20causality.%20The%20previous%20equation%20(although%20more%20flexible)%20does%20not%20obey%20causality%20(there's%20no%20absorption%20corresponding%20to%20some%20of%20its%20resonances%20so%20by%20definition%20it%20doesn't%20obey%20the%20Kramers-Kronig%20relations)%20and%20doesn't%20have%20a%20purely%20time-domain%20equation%20of%20motion%20associated%20with%20it.%0A%0A%20%20%20%20%20%20%20%20The%20final%20equation%20that's%20implemented%20is%20a%20series%20of%20Gaussian%20resonances%2C%20whose%20associated%20contribution%20to%20the%20real%20part%20of%20the%20susceptibility%20is%20a%20Dawson%20function%20F%20(the%20Dawson%20function%20is%20the%20Hilbert%20transform%20of%20a%20Gaussian).%20This%20equation%20does%20in%20fact%20obey%20causality%20and%20could%20in%20principle%20be%20associated%20with%20a%20pure%20time-domain%20response%20suitable%20for%20FDTD%2C%20but%20is%20not%20yet%20implemented%20there%20because%20I%20haven't%20found%20an%20efficient%20way%20to%20do%20it%20(although%20I'm%20convinced%20that%20one%20exists).%20Gaussian%20functions%20(i.e.%20inhomogenously%20broadened%20lines)%20often%20exhibit%20better%20agreement%20with%20resonances%20inside%20of%20solids.%20This%20model%20looks%20like%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20n%5E2%20%3D%20a%5B0%5D%20%2B%20%5Csum_%7Bi%7D%7B-%5Cfrac%7B1%7D%7B%5Csqrt%7B%5Cpi%7D%7Da%5B3i%5D%5Cleft(F%5Cleft(%7B%5Comega_s(i)%7D%5Cright)%20-%20e%5E%7B-%5Comega_s%5E2(i)%7D%5Cright)%7D%5Ctag%7B8%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Comega_s%20%3D%20%5Cfrac%7B%5Comega%20-%20a%5B1%20%2B%203i%5D%7D%7B%5Csqrt%7B2%7D%20a%5B2%2B3i%5D%7D%5Ctag%7B9%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20which%20is%20to%20say%2C%20each%20resonance%20has%20a%20strength%20given%20by%20a%20parameter%20in%20the%20array%2C%20and%20a%20scaled%20frequency%20axis%20given%20by%20%24%5Comega_s%24%2C%20which%20is%20scaled%20by%20two%20additional%20parameters.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20Nonlinear%20crystal%20properties%0A%20%20%20%20%20%20%20%20-----%0A%0A%20%20%20%20%20%20%20%20There%20are%20currently%20three%20different%20types%20of%20nonlinear%20effects%20that%20can%20happen%20inside%20of%20the%20simulation%3A%20second%20order%2C%20such%20as%20second%20harmonic%20generation%20and%20difference%20frequency%20generation%2C%20third%20order%2C%20such%20as%20the%20Kerr%20effect%2C%20four-wave%20mixing%2C%20and%20third%20harmonic%20generation%2C%20and%20multiphoton%20absorption%2Fnonlinear%20plasma%20interaction%20in%20a%20classical%20picture%20of%20free%20carriers.%0A%0A%20%20%20%20%20%20%20%20The%20nonlinear%20tensors%20are%20supplied%20to%20the%20program%20in%20the%20form%20of%20the%20contracted%20notation%20for%20%24%5Cchi%5E%7B(2)%7D%24%2C%20as%20this%20is%20the%20most%20readily%20available%20in%20the%20literature%2C%20and%20in%20the%20full%2081-component%20form%20of%20%24%5Cchi%5E%7B(3)%7D%24.%20For%20%24%5Cchi%5E%7B(3)%7D%24%2C%20a%20second%20mode%20is%20allowed%2C%20where%20only%20one%20value%20is%20supplied%2C%20%24%5Cchi%5E%7B(3)%7D_%7B1111%7D%24%2C%20and%20the%20propagation%20will%20work%20under%20the%20assumtion%20of%20a%20centrosymmetric%20medium.%20This%20is%20often%20all%20the%20information%20available%20in%20literature%20for%20a%20given%20material%2C%20even%20if%20we%20know%20that%20the%20tensor%20has%20other%20independent%20elements.%20If%20your%20measurement%20is%20sensitive%20to%20these%20unknown%20elements%2C%20maybe%20with%20the%20right%20modelling%20and%20fitting%2C%20you%20can%20provide%20the%20first%20experimental%20values.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%20Plasma%20formation%0A%20%20%20%20%20%20%20%20In%20many%20crystals%2C%20the%20damage%20mechanism%20will%20be%20multiphoton%20absorption%20followed%20by%20free-carrier%20absorption.%20In%20other%20cases%2C%20these%20effects%20will%20limit%20the%20intensity%20inside%20of%20the%20medium%2C%20through%20intensity%20claming%2C%20or%20the%20plasma%20formation%20may%20participate%20in%20your%20nonlinear%20process.%20This%20phenomenon%20is%20complex%20(and%20interesting!)%20but%20a%20full%20quantum%20mechanical%20calculation%20is%20not%20included%20presently.%20Instead%2C%20there%20is%20a%20classical%20approximation%20that%20has%20empiracally%20been%20observed%20to%20be%20quite%20effective%3A%20the%20Drude%20model.%0A%0A%20%20%20%20%20%20%20%20This%20calculation%20is%20done%20in%20the%20time%20domain%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20J%5E%7B%5Cmathrm%7BDrude%7D%7D_i(t)%20%3D%20%5Cfrac%7Be%5E2%7D%7B%5Cmu_e%7D%5Cexp%7B%5Cleft(-%5Cgamma%20t%5Cright)%7D%5Cint_%7B-%5Cinfty%7D%5Et%20dt'%20%5Cexp%7B%5Cleft(%5Cgamma%20t%5Cright)%7D%20N(t)%20E_i(t)%5Ctag%7B10%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20where%20%24e%24%20is%20the%20electron%20charge%2C%20%24%5Cmu_e%24%20is%20the%20reduced%20effective%20mass%2C%20%24%5Cgamma%24%20is%20the%20momentum%20relaxation%20rate%2C%20and%20N(t)%20is%20the%20density%20of%20free%20carriers.%20%24E_i%24%20indicates%20the%20field%20in%20the%20%24i%24-direction%2C%20where%20%24E%24%20with%20no%20index%20indicates%20the%20total%20field%20magnitude%2C%20%24E%20%3D%20%5Csqrt%7B%5Csum%20E_i%5E2%7D%24%0A%0A%0A%20%20%20%20%20%20%20%20To%20perform%20this%20calculation%2C%20we%20need%20the%20time-dependent%20carrier%20density%20%24N%24%20and%20must%20conserve%20energy%20in%20the%20absorption%20process.%20Exciting%20the%20system%20and%20introducing%20a%20pair%20of%20carriers%20costs%20energy%2C%20in%20the%20form%20of%20%24n%24%20photons.%20The%20field%20must%20then%20also%20see%20an%20absorptive%20nonlinearity%2C%20whose%20associated%20current%20is%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20J%5E%5Cmathrm%7Babs%7D_i(t)%20%3D%20%5Cbeta%20E%5E%7B2n-2%7D(t)E_i(t)%5Ctag%7B11%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20where%20%24%5Cbeta%24%20is%20a%20nonlinear%20absorption%20parameter%2C%20which%20will%20depend%20on%20the%20system%20and%20frequency%20of%20the%20excitation.%20From%20this%20rate%20of%20nonlinear%20absorption%2C%20the%20power%20transfer%20from%20the%20field%20to%20the%20system%20will%20be%20%24%5Csum%20J%5E%5Cmathrm%7Babs%7D_i(t)E_i(t)%24.%0A%0A%20%20%20%20%20%20%20%20Accordingly%2C%20the%20number%20of%20carriers%20generated%2C%20assuming%20that%20they%20just%20go%20to%20the%20%24%5CGamma%24%20point%20of%20the%20crystal%20is%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cfrac%7Bd%20N(t)%7D%7Bd%20t%7D%20%3D%20%5Cfrac%7B2%7D%7B%5CDelta_g%7D%5Csum%20J%5E%5Cmathrm%7Babs%7D_i(t)E_i(t)%5Ctag%7B12%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20where%20%24%5CDelta_g%24%20is%20the%20band%20gap.%20The%20factor%20of%202%20is%20due%20to%20the%20creation%20of%20an%20electron-hole%20pair.%0A%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20Dispersion%20of%20the%20nonlinear%20coefficients%0A%20%20%20%20%20%20%20%20In%20all%20cases%2C%20we%20take%20into%20account%20the%20dispersion%20of%20the%20nonlinear%20coefficients%20through%20Miller's%20rule%2C%20or%20an%20extrapolation%20of%20it%20to%20higher%20orders.%20Miller's%20rule%20is%20the%20idea%20that%20the%20nonlinear%20susceptibilities%20will%20scale%20with%20the%20linear%20ones%2C%20so%20in%20the%20case%20of%20%24%5Cchi%5E%7B(2)%7D%24%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cchi%5E%7B(2)%7D_%7Bijk%7D%5Cleft(%5Comega_1%2B%5Cdelta_1%2C%5Comega_2%2B%5Cdelta_2%3B%5Comega_3%2B%5Cdelta_3%5Cright)%20%5Capprox%20%5Cfrac%7B%5Cchi%5E%7B(1)%7D_i(%5Comega_1%20%2B%20%5Cdelta_1)%5Cchi%5E%7B(1)%7D_j(%5Comega_2%2B%5Cdelta_2)%5Cchi%5E%7B(1)%7D_k(%5Comega_3%2B%5Cdelta_3)%7D%7B%5Cchi%5E%7B(1)%7D_i(%5Comega_1)%5Cchi%5E%7B(1)%7D_j(%5Comega_2)%5Cchi%5E%7B(1)%7D_k(%5Comega_3)%7D%5Cchi%5E%7B(2)%7D_%7Bijk%7D%5Cleft(%5Comega_1%2C%5Comega_2%3B%5Comega_3%5Cright)%5Ctag%7B13%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20Doing%20so%20allows%20us%20to%20approximate%20the%20dispersive%20behavior%20of%20the%20nonlinear%20coefficients%20to%20a%20good%20degree%20of%20accuracy%2C%20especially%20if%20the%20resonances%20are%20Lorentzian%20or%20far%20away%20from%20all%20frequencies.%20To%20extend%20this%20to%20higher%20order%20nonlinearities%2C%20the%20pattern%20is%20identical%2C%20but%20the%20numbered%20indicies%20extend%20up%20to%20higher%20numbers.%20%0A%0A%20%20%20%20%20%20%20%20Miller's%20rule%20strictly%20speaking%20is%20the%20case%20up%20to%203.%20The%20higher%20the%20nonlinearity%2C%20the%20more%20likely%20one%20is%20to%20have%20components%20close%20to%20resonances%2C%20where%20things%20can%20go%20wrong%3A%20for%20example%2C%20infrared-active%20phonon%20modes%20will%20affect%20%24%5Cchi%5E%7B(3)%7D%24%2C%20instead%20of%20the%20Raman-active%20ones.%20For%20calculating%20resonant%20behavior%2C%20a%20different%20calculation%20should%20be%20added%20to%20the%20nonlinear%20polarization%20tailored%20to%20the%20specific%20problem.%0A%0A%20%20%20%20%20%20%20%20As%20a%20result%2C%20the%20applied%20nonlinearities%20are%20not%20instantaneous%3A%20the%20response%20to%20a%20%24%5Cdelta%24-function%20excitation%20will%20not%20be%20another%20%24%5Cdelta%24-function.%20Practically%2C%20this%20helps%20avoid%20overestimates%20e.g.%20of%20infrared%20nonlinearities%20based%20on%20coefficients%20taken%20from%20visible%20measurements.%20It%20also%20means%20that%20when%20configuring%20a%20crystal%2C%20you%20need%20to%20supply%20the%20frequencies%20at%20which%20the%20measurement%20that%20provided%20the%20elements%20of%20the%20nonlinear%20tensor%20was%20performed.%20Without%20these%2C%20the%20response%20_will_%20be%20treated%20as%20instantaneous.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%23%23%20Crystal%20properties%20in%20FDTD%20mode%0A%20%20%20%20%20%20%20%20In%20FDTD%20mode%2C%20the%20crystal%20response%20is%20contained%20in%20two%20places%3A%20a%20frequency-independent%20modification%20of%20the%20dielectric%20constant%2C%20e.g.%20%24%5Cepsilon_%5Cinfty%24%20obtained%20from%20the%20first%20element%20of%20the%20Sellmeier%20coefficient%20array%2C%20and%20the%20current%20%24%5Cmathbf%7BJ%7D%24.%20The%20former%20is%20straight-forward%3A%20in%20Ampere's%20law%2C%20we%20just%20replace%20%24%5Cepsilon_0%24%20with%20%24%5Cepsilon_0%5Cepsilon_%5Cinfty%24.%20The%20rest%20of%20the%20response%2C%20including%20all%20of%20the%20nonlinear%20optical%20responses%2C%20comes%20through%20%24%5Cmathbf%7BJ%7D%24%2C%20and%20requires%20more%20care.%0A%0A%20%20%20%20%20%20%20%20Ideally%2C%20the%20response%20we%20end%20up%20with%20should%20be%20consistent%20with%20the%20dispersion%20of%20the%20nonlinear%20effects%20obtained%20through%20Miller's%20rule%20above%2C%20such%20that%20the%20different%20modes%20of%20propagation%20have%20similar%20approximations%20to%20the%20local%20polarization%20response.%20We%20just%20have%20to%20translate%20the%20frequency-domain%20picture%20into%20a%20purely%20time-domain%20one%20such%20that%20we%20can%20solve%20it%20in%20FDTD.%0A%0A%20%20%20%20%20%20%20%20It%20turns%20out%20to%20be%20fairly%20straightforward.%20Applying%20Miller's%20rule%20is%20equivalent%20to%20using%20a%20scaled%20version%20of%20the%20nonlinear%20coefficient%2C%20and%20instead%20of%20mixing%20the%20fields%20%24E_1(t)%24%20and%20%24E_2(t)%24%2C%20we%20mix%20the%20polarizations%20%24P_1(t)%20%3D%20%5Cchi%5E%7B(1)%7D(t)%20%5Cast%20E_1(t)%24%20and%20%24P_2(t)%20%3D%20%5Cchi%5E%7B(1)%7D(t)%20%5Cast%20E_2(t)%24.%20Here%20I'm%20using%20the%20symbol%20%24%5Cast%24%20to%20denote%20convolution.%20Satisfying%20the%20above%20formulation%20of%20Miller's%20rule%20requires%20us%20to%20calculate%20the%20nonlinear%20polarization%20as%20(for%20the%20example%20of%20a%20second%20order%20nonlinearity)%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20P_k%5E%7B(2)%7D(t)%20%3D%20%5Cchi%5E%7B1%7D(t)%20%5Cast%20%5Cchi%5E%7B(2)*%7D_%7Bijk%7DP_i(t)P_k(t)%5Ctag%7B14%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20where%20%24P_k%24%20is%20a%20given%20polarization%20component%2C%20and%20%24%5Cchi%5E%7B(2)*%7D_%7Bijk%7D%24%20is%20a%20given%20scaled%20component%20of%20the%20non-contracted%20nonlinear%20tensor.%20Essentially%2C%20we%20just%20have%20to%20do%20an%20additional%20convolution%20of%20the%20nonlinear%20response%20with%20the%20linear%20response%20function.%0A%0A%20%20%20%20%20%20%20%20First%2C%20we%20have%20to%20scale%20the%20nonlinear%20tensor.%20What%20I%20mean%20by%20that%20is%20that%20typically%20in%20literature%2C%20we'll%20have%20a%20single%20value%20of%20the%20tensor%20component%2C%20e.g.%20a%20number%20in%20pm%2FV%2C%20which%20was%20measured%20in%20a%20given%20way.%20For%20example%2C%20if%20it%20was%20measured%20using%20second%20harmonic%20generation%20of%20a%201064-nm%20laser%20to%20532-nm%2C%20it%20corresponds%20specifically%20to%20the%20components%20of%20%24%5Cchi%5E%7B(2)%7D%24(1064%20nm%2C%201064%20nm%2C%20532%20nm).%20Using%20the%20above%20equations%20formulating%20the%20response%20in%20terms%20of%20polarizations%2C%20we%20can%20extend%20this%20to%20an%20arbitrary%20combination%20of%20wavelengths%2C%20but%20we%20must%20first%20apply%20the%20denominator%20of%20the%20Miller's%20rule%20expression%20to%20get%20the%20scaled%20tensor%20components%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cchi%5E%7B(2)*%7D%20%3D%20%5Cfrac%7B%5Cchi%5E%7B(2)%7D(%5Comega_1%2C%5Comega_2%3B%5Comega_3)%7D%7B%5Cchi%5E%7B(1)%7D(%5Comega_1)%5Cchi%5E%7B(1)%7D(%5Comega_2)%5Cchi%5E%7B(1)%7D(%5Comega_3)%7D%5Ctag%7B15%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20within%20the%20Miller's%20rule%20model%2C%20these%20scaled%20tensor%20components%20are%20frequency-independent.%20The%20frequency-dependence%20of%20the%20resulting%20polarization%20response%20comes%20through%20the%20application%20of%20the%20first-order%20response%20function%20to%20the%20polarizations%20serving%20as%20inputs%20to%20this%20equation%2C%20and%20the%20final%20convolution%20of%20the%20resulting%20nonlinear%20polarization%20it%20contains.%0A%0A%20%20%20%20%20%20%20%20We%20have%20in%20fact%20already%20set%20up%20the%20required%20numerical%20system%20for%20performing%20this%20convolution%20in%20the%20time%20domain%20--%20it's%20just%20the%20oscillators%20whose%20equations%20of%20motion%20we%20are%20solving%20to%20obtain%20the%20current%20required%20for%20linear%20propagation.%20We%20just%20have%20to%20replace%20the%20electric%20field%20in%20the%20driving%20term%20with%20a%20more%20generalized%20force%20%24%5Cmathbf%7BF%7D%24%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cfrac%7B1%7D%7Be%7D%5Cmathbf%7BF%7D%20%3D%20%5Cmathbf%7BE%7D%20%2B%20%5Cmathbf%7BP%7D%5E%7BN*%7D%5Ctag%7B16%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20where%20%24%5Cmathbf%7BP%7D%5E%7BN*%7D%24%20is%20the%20sum%20of%20all%20of%20the%20nonlinear%20polarizations%20calculated%20using%20linear%20polarization%20as%20the%20input%20and%20the%20scaled%20nonlinear%20tensors.%0A%0A%20%20%20%20%20%20%20%20Simply%20adding%20this%20additional%20driving%20term%20to%20the%20equations%20of%20motion%20for%20the%20oscillators%20allows%20the%20fully-time%20domain%20calculation%20of%20the%20nonlinear%20polarization%20within%20the%20Miller's%20rule%20approximation%2C%20but%20is%20missing%20one%20component%3A%20the%20*instantaneous*%20response%20in%20some%20of%20the%20Sellmeier%20equations%2C%20i.e.%20when%20a%5B0%5D%20doesn't%20equal%201.%20This%20part%20of%20the%20linear%20response%20is%20not%20associated%20with%20an%20oscillator%2C%20so%20it%20has%20to%20be%20handled%20independently.%0A%0A%20%20%20%20%20%20%20%20Since%20in%20calculating%20the%20change%20in%20field%20through%20Ampere's%20law%20we%20need%20the%20associated%20*current*%20and%20not%20the%20polarization%2C%20it's%20a%20bit%20tricky!%0A%0A%20%20%20%20%20%20%20%20In%20addition%20to%20the%20nonlinear%20driver%20term%20%24%5Cmathbf%7BP%7D%5E%7BN*%7D%24%2C%20we%20also%20need%20to%20find%20its%20time-derivative%20%24%5Cmathbf%7BJ%7D%5E%7BN*%7D%24%20because%20the%20contribution%20of%20the%20instantaneous%20response%20to%20the%20nonlinear%20current%20will%20be%20%24(%5Cepsilon_%5Cinfty%20-%201)%5Cmathbf%7BJ%7D%5E%7BN*%7D%24.%20Calculating%20this%20requires%20having%20access%20to%20the%20derivative%20of%20the%20polarization.%20The%20parts%20of%20it%20associated%20with%20the%20oscillators%20are%20easy%2C%20but%20due%20to%20the%20presence%20of%20an%20instantaneous%20term%2C%20that%20bit%20that%20we%20eliminated%20from%20explicit%20calculation%20by%20the%20substitution%20%24%5Cepsilon_0%24%20to%20%24%5Cepsilon_0%5Cepsilon_%5Cinfty%24%2C%20we%20need%20to%20obtain%20the%20time-derivative%20of%20the%20field%20so%20that%20we%20can%20calculate%20the%20full%20time%20derivative%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cfrac%7B%5Cpartial%5Cmathbf%7BP%7D%7D%7B%5Cpartial%20t%7D%20%3D%20(%5Cepsilon_%5Cinfty%20-%201)%20%5Cfrac%7B%5Cpartial%20%5Cmathbf%7BE%7D%7D%7B%5Cpartial%20t%7D%20%2B%20%5Cmathbf%7BJ%5E%7B(1)%7D%7D%5Ctag%7B17%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20We%20can%20obtain%20%24%5Cfrac%7B%5Cpartial%20%5Cmathbf%7BE%7D%7D%7B%5Cpartial%20t%7D%24%20and%20%24%5Cmathbf%7BJ%5E%7B(1)%7D%7D%24%20(the%20linear%20response%20dipole%20current)%20through%20the%20solution%20of%20Ampere's%20law%20that%20we've%20already%20done%20through%20the%20calculations%20for%20however!%0A%0A%20%20%20%20%20%20%20%20We%20then%20just%20need%20to%20calculate%20the%20contributions%20to%20%24%5Cmathbf%7BJ%7D%24%20from%20the%20instantaneous%20responses%20using%20these%20values%20and%20the%20product%20rule%20for%20derivatives%2C%20e.g.%20for%20the%20example%20above%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20J_k%5E%7B%5Cinfty%7D%20%3D%20%5Cfrac%7B%5Cpartial%20P_k%5E%7B(2)%7D(t)%7D%7B%5Cpartial%20t%7D%20%3D%20(%5Cepsilon_%5Cinfty%20-%201)%20%5Cchi%5E%7B(2)*%7D_%7Bijk%7D%5Cleft(%5Cfrac%7B%5Cpartial%20P_i(t)%7D%7B%5Cpartial%20t%7DP_k(t)%20%2B%20P_i(t)%5Cfrac%7B%5Cpartial%20P_k(t)%7D%7B%5Cpartial%20t%7D%5Cright)%5Ctag%7B18%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20Adding%20these%20current%20terms%20(remember%20we%20have%20to%20do%20this%20product%20rule%20for%20each%20combination%20of%20fields%20corresponding%20to%20a%20tensor%20component!)%20we%20have%20the%20complete%20nonlinear%20response.%20And%20we've%20done%20it%20purely%20in%20the%20time%20domain%2C%20which%20is%20required%20for%20FDTD.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%23%20Matrix%20math%20for%20rotating%20into%20and%20out%20of%20the%20crystal%20frame%0A%0A%20%20%20%20%20%20%20%20A%20confusing%20aspect%20of%20nonlinear%20optics%20is%20getting%20into%20and%20out%20of%20the%20crystal%20coordinate%20system%2C%20starting%20from%20the%20coordinate%20system%20of%20the%20beam.%0A%20%20%20%20%20%20%20%20Here%2C%20I'm%20assuming%20that%20the%20beam%20is%20pointing%20in%20the%20z-direction%2C%20and%20we%20have%20a%20set%20of%20crystal%20angles%2C%20%24%5Ctheta%24%20and%20%24%5Cphi%24%20which%20give%20the%20orientation%20of%20the%20crystal%20surface%20relative%20to%20the%20internal%20coordinates%20of%20the%20crystal.%0A%0A%20%20%20%20%20%20%20%20We%20need%20to%20move%20from%20the%20beam%20coordinates%20%24(x%2C%20y%2C%20z)%24%20to%20the%20crystal%20coordinates%20%24(x'%2C%20y'%2C%20z')%24.%20Essentially%20the%20crystal%20angles%20give%20the%20orientation%20of%20the%20beam's%20propagation%20vector%20(%24%5Chat%7Bz%7D%24)%20relative%20to%20the%20%24%5Chat%7Bz%7D'%24%20axis%20of%20the%20crystal.%20This%20takes%20the%20form%20of%20several%20rotations%2C%20and%20we%20have%20to%20do%20them%20in%20the%20correct%20order%20and%20direction.%0A%0A%20%20%20%20%20%20%20%20We'll%20start%20out%20in%20a%20simple%20case%2C%20a%20uniaxial%20crystal%2C%20and%20add%20complications%20as%20necessary%20for%20dealing%20with%20the%20more%20complex%20crystal%20systems.%0A%0A%20%20%20%20%20%20%20%20Say%20we%20have%20our%20fields%20in%20the%20beam%20coordinate%20system.%20We%20want%20to%20move%20to%20the%20crystal%20coordinates%20in%20order%20to%20perform%20a%20calculation.%20Because%20we%20are%20already%20rotated%20relative%20to%20the%20principle%20axes%20of%20the%20crystal%2C%20we%20effectively%20have%20to%20undo%20the%20rotation%20we've%20accumulated.%20The%20correct%20order%20for%20this%20is%20to%20first%20rotate%20by%20%24-%5Ctheta%24%20around%20the%20y'-axis%2C%20and%20then%20by%20%24-%5Cphi%24%20around%20the%20z'-axis.%20The%20rotation%20matrices%20take%20the%20usual%20form%3A%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20R_y%5Cleft(%5Ctheta%5Cright)%20%3D%20%5Cleft%5B%5Cbegin%7Bmatrix%7D%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%26%200%20%26%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5C%5C0%20%26%201%20%26%200%5C%5C-%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%26%200%20%26%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cend%7Bmatrix%7D%5Cright%5D%5Ctag%7B19%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20R_z%5Cleft(%5Cphi%5Cright)%20%3D%20%5Cleft%5B%5Cbegin%7Bmatrix%7D%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%26%20-%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%26%200%5C%5C%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%26%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%26%200%5C%5C0%20%26%200%20%26%201%5Cend%7Bmatrix%7D%5Cright%5D%5Ctag%7B20%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20The%20combined%20forward%20matrix%20%24R_f%5Cleft(%5Ctheta%2C%5Cphi%5Cright)%20%3D%20R_z%5Cleft(-%5Cphi%5Cright)%20R_y%5Cleft(-%5Ctheta%5Cright)%24%20is%20then%3A%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20R_f%5Cleft(%5Ctheta%2C%5Cphi%5Cright)%20%3D%20%5Cleft%5B%5Cbegin%7Bmatrix%7D%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%26%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%26%20-%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%5C%5C-%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%26%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%26%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5C%5C%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%26%200%20%26%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cend%7Bmatrix%7D%5Cright%5D%5Ctag%7B21%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20To%20get%20back%20out%20of%20the%20crystal%20system%2C%20we%20have%20the%20opposite%20sign%20of%20the%20angles%20and%20apply%20the%20rotations%20in%20reverse%20order%2C%20so%20the%20backwards%20matrix%20%24R_b%5Cleft(%5Ctheta%2C%5Cphi%5Cright)%20%3D%20%20R_y%5Cleft(%5Ctheta%5Cright)%20R_z%5Cleft(%5Cphi%5Cright)%24%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20R_b%5Cleft(%5Ctheta%2C%5Cphi%5Cright)%20%3D%20%5Cleft%5B%5Cbegin%7Bmatrix%7D%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%26%20-%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%26%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5C%5C%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%26%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%26%200%5C%5C-%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%26%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%26%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cend%7Bmatrix%7D%5Cright%5D%5Ctag%7B22%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20In%20the%20current%20version%20of%20the%20code%2C%20this%20pair%20of%20rotations%20is%20done%20at%20each%20propagation%20step%2C%20rotating%20from%20the%20beam%20frame%20to%20the%20crystal%20frame%2C%20calculating%20the%20nonlinear%20polarization%20along%20the%20principle%20axes%20and%20then%20rotating%20the%20polarization%20back%20into%20the%20beam%20frame.%20You%20may%20notice%20that%20this%20could%20be%20optimized%20by%20pre-calculating%20an%20effective%20tensor%20in%20the%20beam%20frame.%20This%20optimization%20has%20been%20left%20for%20a%20later%20date%2C%20so%20that%20the%20first%20correctness%20checks%20are%20done%20in%20an%20easier-to-diagnose%20form%2C%20where%20the%20a%20priori%20known%20tensors%20are%20in%20the%20inner%20loop.%20Since%20this%20rotation%20is%20much%20faster%20than%20the%20Fourier%20transforms%20needed%20to%20obtain%20the%20polarization%20in%20any%20case%2C%20it%20is%20not%20expected%20to%20be%20a%20big%20deal.%0A%0A%20%20%20%20%20%20%20%20These%20same%20matrices%20naturally%20give%20us%20expressions%20for%20the%20refractive%20indices%20for%20the%20two%20principle%20polarization%20components%20%24E_x%2C%20E_y%24.%20In%20the%20typical%20manner%20of%20the%20refractive%20index%20ellipsoid%2C%20we%20have%20to%20deal%20with%20the%20diagonal%20matrix%20N%20in%20the%20cystal%20frame%3A%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20N%20%3D%20%5Cleft%5B%5Cbegin%7Bmatrix%7D%5Cfrac%7B1%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%20%26%200%20%26%200%5C%5C0%20%26%20%5Cfrac%7B1%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20%26%200%5C%5C0%20%26%200%20%26%20%5Cfrac%7B1%7D%7Bn_%7Bz%7D%5E%7B2%7D%7D%5Cend%7Bmatrix%7D%5Cright%5D%5Ctag%7B23%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20The%20effective%20refractive%20indices%20for%20the%20beam's%20principle%20axes%20are%20then%20found%20along%20the%20diagonal%20of%20the%20matrix%20%24N_e%20%3D%20R_b%5Cleft(%5Ctheta%2C%5Cphi%5Cright)%20N%20R_f%5Cleft(%5Ctheta%2C%5Cphi%5Cright)%24%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20N_e%20%3D%20%5Cleft%5B%5Cbegin%7Bmatrix%7D%5Cfrac%7B%5Csin%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bz%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Csin%5E%7B2%7D%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Ccos%5E%7B2%7D%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%20%26%20-%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%20%26%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bz%7D%5E%7B2%7D%7D%20-%20%5Cfrac%7B%5Csin%5E%7B2%7D%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20-%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%5E%7B2%7D%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%5C%5C-%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%20%26%20%5Cfrac%7B%5Ccos%5E%7B2%7D%7B%5Cleft(%5Cphi%20%5Cright)%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Csin%5E%7B2%7D%7B%5Cleft(%5Cphi%20%5Cright)%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%20%26%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20-%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%5C%5C%5Cfrac%7B%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bz%7D%5E%7B2%7D%7D%20-%20%5Cfrac%7B%5Csin%5E%7B2%7D%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20-%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%5E%7B2%7D%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%20%26%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20-%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%20%26%20%5Cfrac%7B%5Ccos%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bz%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Csin%5E%7B2%7D%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Csin%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%5E%7B2%7D%7B%5Cleft(%5Cphi%20%5Cright)%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%5Cend%7Bmatrix%7D%5Cright%5D%5Ctag%7B24%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20If%20%24n_x%20%3D%20n_y%24%20(i.e.%20we%20have%20a%20uniaxial%20crystal)%2C%20the%20off-diagonal%20values%20at%20the%200%2C1%20and%201%2C0%20indices%20of%20the%20matrix%20are%20zero%2C%20and%20we%20can%20simply%20read%20off%20the%20first%20two%20diagonal%20elements%20to%20get%20the%20extraordinary%20and%20ordinary%20refractive%20index%20values%20for%20the%20beam.%20%0A%0A%0A%20%20%20%20%20%20%20%20Now%2C%20let's%20look%20at%20more%20complicated%20crystals%2C%20biaxial%20ones%20which%20still%20have%20orthogonal%20axes.%20This%20includes%20orthorhombic%20systems.%20%24n_x%24%2C%20%24n_y%24%2C%20and%20%24n_z%24%20are%20independent%2C%20so%20we%20have%20to%20perform%20an%20additional%20rotation%20around%20the%20beam's%20z-axis%20to%20orient%20the%20beam%20x%20and%20y%20to%20the%20refractive%20index%20ellipsoid.%20%0A%0A%20%20%20%20%20%20%20%20First%2C%20we%20redefine%20our%20forward%20and%20backward%20rotation%20matrices%20to%20incorporate%20the%20rotation%20around%20the%20beam's%20z-axis%2C%20%24%5Cdelta%24%3A%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20R_f%5Cleft(%5Ctheta%2C%5Cphi%2C%5Cdelta%5Cright)%20%3D%20%5Cleft%5B%5Cbegin%7Bmatrix%7D-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%2B%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%26%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%26%20-%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%5C%5C-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20-%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%26%20-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%26%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5C%5C%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%26%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%26%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cend%7Bmatrix%7D%5Cright%5D%5Ctag%7B25%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20R_b%5Cleft(%5Ctheta%2C%5Cphi%2C%5Cdelta%5Cright)%20%3D%20%5Cleft%5B%5Cbegin%7Bmatrix%7D-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%2B%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%26%20-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20-%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%26%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%5C%5C%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%26%20-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%26%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5C%5C-%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%26%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%26%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cend%7Bmatrix%7D%5Cright%5D%5Ctag%7B26%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20And%20the%20(big)%20matrix%20giving%20the%20refractive%20index%20values%20is%20%24N_e%20%3D%20R_b%5Cleft(%5Ctheta%2C%5Cphi%2C%5Cdelta%5Cright)%20N%20R_f%5Cleft(%5Ctheta%2C%5Cphi%2C%5Cdelta%5Cright)%24%3A%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cleft%5B%5Cbegin%7Bmatrix%7D%5Cfrac%7B%5Csin%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%5E%7B2%7D%7B%5Cleft(%5Cdelta%20%5Cright)%7D%7D%7Bn_%7Bz%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20-%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cright)%5E%7B2%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%2B%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cright)%5E%7B2%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%20%26%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%7D%7Bn_%7Bz%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20-%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cright)%20%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%5Cright)%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%2B%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cright)%20%5Cleft(%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%5Cright)%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%20%26%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bz%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20-%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cright)%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20-%20%5Cfrac%7B%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%2B%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cright)%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%5C%5C%5Cfrac%7B%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%7D%7Bn_%7Bz%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20-%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cright)%20%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%5Cright)%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%2B%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cright)%20%5Cleft(%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%5Cright)%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%20%26%20%5Cfrac%7B%5Csin%5E%7B2%7D%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bz%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%5Cright)%5E%7B2%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Cleft(%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%5Cright)%5E%7B2%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%20%26%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bz%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%5Cright)%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20-%20%5Cfrac%7B%5Cleft(%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%5Cright)%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%5C%5C%5Cfrac%7B%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bz%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20-%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cright)%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20-%20%5Cfrac%7B%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%2B%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cright)%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%20%26%20%5Cfrac%7B%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bz%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Cleft(-%20%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%5Cright)%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20-%20%5Cfrac%7B%5Cleft(%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%5Cright)%20%5Csin%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%20%26%20%5Cfrac%7B%5Ccos%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7Bz%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Csin%5E%7B2%7D%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Csin%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%7D%7Bn_%7By%7D%5E%7B2%7D%7D%20%2B%20%5Cfrac%7B%5Csin%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%5E%7B2%7D%7B%5Cleft(%5Cphi%20%5Cright)%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%7D%5Cend%7Bmatrix%7D%5Cright%5D%5Ctag%7B27%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20The%20value%20of%20%24%5Cdelta%24%20that%20sets%20the%20off-diagonals%20at%200%2C1%20and%201%2C0%20to%20zero%20is%3A%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Ctan%7B2%5Cdelta%7D%20%3D%20%5Cfrac%7B%5Csin%7B2%5Cphi%7D%5Ccos%7B%5Ctheta%7D%7D%7B%5COmega%5Csin%5E2%5Ctheta%20-%20%5Ccos%5E2%5Cphi%5Ccos%5E2%5Ctheta%20%2B%20%5Csin%5E2%5Cphi%7D%5Ctag%7B28%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20where%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5COmega%20%3D%20%5Cfrac%7B%5Cfrac%7B1%7D%7Bn%5E2_y%7D%20-%20%5Cfrac%7B1%7D%7Bn%5E2_z%7D%7D%7B%5Cfrac%7B1%7D%7Bn%5E2_x%7D%20-%20%5Cfrac%7B1%7D%7Bn%5E2_y%7D%7D.%5Ctag%7B29%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20We%20can%20now%20write%20down%20expressions%20for%20the%20effective%20refractive%20indices%20for%20the%20principle%20field%20axes%20in%20the%20beam%20coordinates%3A%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20n_x%5Ee%20%3D%20%5Csqrt%7B%5Cfrac%7Bn_%7Bx%7D%5E%7B2%7D%20n_%7By%7D%5E%7B2%7D%20n_%7Bz%7D%5E%7B2%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%20n_%7By%7D%5E%7B2%7D%20%5Csin%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%5Ccos%5E%7B2%7D%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%2B%20n_%7Bx%7D%5E%7B2%7D%20n_%7Bz%7D%5E%7B2%7D%20%5Cleft(%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%2B%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cright)%5E%7B2%7D%20%2B%20n_%7By%7D%5E%7B2%7D%20n_%7Bz%7D%5E%7B2%7D%20%5Cleft(%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20-%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%5Cright)%5E%7B2%7D%7D%7D%5Ctag%7B30%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20n_y%5Ee%20%3D%20%5Csqrt%7B%5Cfrac%7Bn_%7Bx%7D%5E%7B2%7D%20n_%7By%7D%5E%7B2%7D%20n_%7Bz%7D%5E%7B2%7D%7D%7Bn_%7Bx%7D%5E%7B2%7D%20n_%7By%7D%5E%7B2%7D%20%5Csin%5E%7B2%7D%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%5E%7B2%7D%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20n_%7Bx%7D%5E%7B2%7D%20n_%7Bz%7D%5E%7B2%7D%20%5Cleft(%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20-%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%5Cright)%5E%7B2%7D%20%2B%20n_%7By%7D%5E%7B2%7D%20n_%7Bz%7D%5E%7B2%7D%20%5Cleft(%5Csin%7B%5Cleft(%5Cdelta%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Ctheta%20%5Cright)%7D%20%2B%20%5Csin%7B%5Cleft(%5Cphi%20%5Cright)%7D%20%5Ccos%7B%5Cleft(%5Cdelta%20%5Cright)%7D%5Cright)%5E%7B2%7D%7D%7D%5Ctag%7B31%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20Note%20that%20for%20the%20case%20of%20a%20uniaxial%20crystal%2C%20where%20%24n_x%20%3D%20n_y%24%20(so%20%24%5Cdelta%20%3D%200%24)%2C%20this%20reduces%20significantly.%20%24n_x%5Ee%24%20simplifies%20to%20the%20expected%20behavior%20of%20the%20extraordinary%20axis%2C%20and%20%24n_y%5Ee%24%20follows%20that%20of%20the%20ordinary%20axis%20(and%20no%20longer%20depends%20on%20angle%2C%20just%20becoming%20the%20un-rotated%20value%20of%20%24n_y%24).%0A%0A%20%20%20%20%20%20%20%20The%20angle%20%24%5Cdelta%24%20may%20depend%20on%20frequency.%20Accordingly%2C%20the%20optical%20axes%20(the%20orientation%20of%20the%20refractive%20index%20ellipse)%20may%20be%20different%20for%20different%20wavelength%20components%20of%20the%20light.%20This%20has%20a%20significant%20implication%20for%20the%20linear%20and%20nonlinear%20propagation%20of%20the%20light%20field%3A%20there%20has%20to%20be%20an%20additional%20frequency-dependent%20rotation%20of%20the%20field%20vector%20(by%20%24%5Cdelta%24%20around%20the%20z-axis)%20after%20Fourier%20transformation%20to%20enter%20the%20basis%20of%20plane%20waves%20where%20the%20propagator%20is%20diagonalized.%20This%20system%20no%20longer%20corresponds%20to%20the%20lab%20frame%20and%20has%20to%20be%20exited%20before%20results%20are%20interpreted.%0A%0A%20%20%20%20%20%20%20%20In%20LWE%2C%20the%20propagation%20in%20a%20biaxial%20crystal%20will%20be%20done%20using%20the%20crystal%20system%20so%20that%20the%20effect%20of%20the%20wavelength-dependence%20of%20the%20angle%20%24%5Cdelta%24%20will%20be%20present%2C%20but%20the%20result%20will%20always%20be%20in%20the%20lab%20frame.%20This%20means%20that%20the%20portions%20of%20the%20propagation%20which%20take%20place%20in%20the%20frequency%20basis%20will%20be%20rotated%20by%20%24%5Cdelta%24%2C%20but%20the%20result%20will%20not%20be.%20Accordinly%2C%20the%20polarization%20angle%20of%20the%20light%20might%20not%20automatically%20align%20with%20the%20optical%20axes%20(since%20there%20may%20not%20be%20a%20well-defined%20optical%20axis%20for%20a%20broadband%20field).%20A%20pair%20of%20helper%20functions%2C%20described%20in%20the%20section%20on%20sequences%2C%20called%20rotateIntoBiaxial()%20and%20rotateFromBiaxial()%20make%20this%20easier.%0A%0A%20%20%20%20%20%20%20%20In%20the%20FDTD%20mode%2C%20the%20oscillators%20are%20always%20in%20the%20crystal%20frame.%20The%20electric%20field%20vector%20is%20rotated%20into%20this%20frame%2C%20using%20%24R_f%5Cleft(%5Ctheta%2C%5Cphi%5Cright)%24%2C%20and%20then%20the%20results%20are%20rotated%20back%20to%20the%20field%20frame%20using%20%24R_b%5Cleft(%5Ctheta%2C%5Cphi%5Cright)%24.%0A%0A%20%20%20%20%20%20%20%20Now%2C%20let's%20add%20the%20final%20level%20of%20complication.%20When%20working%20with%20the%20refractive%20index%20tensor%20above%2C%20we%20assumed%20it%20was%20diagonal%2C%20but%20this%20is%20not%20always%20the%20case.%20Let's%20look%20at%20the%20triclinic%20crystal.%0A%0A%20%20%20%20%20%20%20%20In%20a%20triclinic%20system%2C%20there%20are%209%20different%20nonzero%20values%20in%20the%20linear%20susceptibility%20tensor%3A%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cchi%5E%7B(1)%7D%20%3D%20%5Cleft%5B%5Cbegin%7Bmatrix%7Dxx%20%26%20xy%20%26%20xz%20%5C%5C%20yx%20%26%20yy%20%26%20yz%20%5C%5C%20zx%20%26%20zy%20%26%20zz%5Cend%7Bmatrix%7D%5Cright%5D%5Ctag%7B32%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20In%20a%20monoclinic%20system%2C%20it's%20a%20bit%20simpler%2C%20with%20only%20one%20pair%20of%20off-diagonal%20elements%3A%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cchi%5E%7B(1)%7D%20%3D%20%5Cleft%5B%5Cbegin%7Bmatrix%7Dxx%20%26%200%20%26%20xz%20%5C%5C%200%20%26%20yy%20%26%200%20%5C%5C%20zx%20%26%200%20%26%20zz%5Cend%7Bmatrix%7D%5Cright%5D%5Ctag%7B33%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20In%20both%20of%20these%20systems%2C%20we%20might%20not%20be%20able%20to%20use%20the%20assumption%20we%20made%20above%20that%20it's%20possible%20in%20principle%20to%20get%20the%20refractive%20index%20matrix%20into%20a%20diagonal%20form.%20In%20the%20worst%20case%2C%20we%20would%20have%20to%20solve%20this%20system%20not%20with%20two%20electric%20field%20components%20coupled%20only%20by%20the%20nonlinearity%20like%20we%20were%20assuming%20for%20the%20UPPE%20propagation%20model%2C%20but%20instead%20treat%20even%20the%20linear%20propagation%20as%20a%20coupled%20differential%20equation.%0A%0A%20%20%20%20%20%20%20%20However%2C%20if%20we%20can%20assume%20that%20the%20tensors%20are%20invariant%20with%20respect%20to%20permutation%20of%20the%20axes%20(e.g.%20%24zx%3Dxz%24)%2C%20which%20should%20hold%20far%20away%20from%20resonances%2C%20they'll%20be%20symmetric%2C%20and%20we%20can%20define%20yet%20another%20rotation%20to%20diagonalize%20these%20matrices.%20Since%20the%20off-diagonal%20components%20will%20still%20have%20a%20frequency-dependent%20dispersion%2C%20the%20angle%20will%20still%20be%20wavelength%20dependent%2C%20however.%20Within%20the%20approximation%20of%20a%20fixed%20angle%2C%20we%20can%20rotate%20the%20tensor%20into%20an%20effective%20orthorhombic%20system.%20It%20is%20only%20to%20this%20level%20of%20approximation%20that%20monoclinic%20and%20triclinic%20systems%20are%20currently%20treated%20within%20LWE%2C%20although%20a%20further%20addition%20is%20planned%20to%20fully%20accommodate%20them.%0A%0A%20%20%20%20%20%20%20%20Note%20that%20when%20you%20do%20this%2C%20you%20will%20also%20have%20to%20rotate%20any%20nonlinear%20tensors%20associated%20with%20the%20system%2C%20since%20they%20are%20usually%20given%20with%20their%20indices%20defined%20by%20the%20crystal%20axes%2C%20not%20the%20optical%20ones%20(and%20the%20symmetry%20that%20you%20can%20use%20to%20check%20their%20validity%20is%20also%20in%20the%20crystal%20frame%20of%20reference).%20There%20are%20functions%20in%20the%20LWE%20python%20module%20to%20apply%20this%20to%20the%20chi(2)%2Fd%20tensors%2C%20called%20chi2axisSwap()%20and%20chi2rotate()%20to%20make%20this%20easier.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%23%20Pulse%20parameters%0A%0A%20%20%20%20%20%20%20%20We%20also%20need%20to%20describe%20the%20initial%20condition%20of%20the%20electric%20field%2C%20as%20that%20is%20what's%20going%20to%20evolve%20over%20the%20course%20of%20the%20simulation.%20Currently%2C%20you%20can%20easily%20add%202%20fields%2C%20and%20go%20up%20to%20an%20arbitrary%20number%20with%20a%20bit%20of%20effort.%20These%20fields%20maybe%20be%20input%20as%20a%20number%20of%20pulse%20parameters%20on%20the%20interface%2C%20or%20you%20may%20load%20the%20results%20of%20a%20FROG%20or%20EOS%20measurement.%20To%20use%20a%20FROG%2C%20you%20need%20to%20provide%20a%20.Speck.dat%20file%20from%20the%20FROG%20software.%20I%20haven't%20decided%20on%20the%20EOS%20format%20yet%2C%20but%20it%20should%20likely%20be%20a%20two-column%20ascii%20file%2C%20first%20column%20time%2C%20second%2C%20field.%0A%0A%20%20%20%20%20%20%20%20If%20you%20use%20a%20synthesized%20field%2C%20it%20will%20be%20defined%20in%20the%20frequency%20domain%2C%20in%20the%20following%20form%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Ctilde%7BE%7D(%5Comega)%20%3D%20A_o%20e%5E%7B-(%5Comega-%5Comega_o)%5E%7BN_s%7D%2F%5CDelta_%5Comega%5E%7BN_s%7D%20-%20i%5Cphi(%5Comega)%7D%5Ctag%7B34%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20where%20%24%5Comega_o%24%20is%20the%20central%20frequency%20of%20the%20pulse%2C%20%24%5CDelta_%5Comega%24%20is%20the%20bandwidth%2C%20%24N_s%24%20is%20the%20order%20of%20the%20supergaussian%2C%20and%20%24%5Cphi(%5Comega)%24%20is%20the%20spectral%20phase%2C%20which%20is%3A%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cphi(%5Comega)%20%3D%20%5Cphi_%7B%5Cmathrm%7Bce%7D%7D%20%2B%20%5Comega%5Ctau%20%2B%20%5Cfrac%7B1%7D%7B2%7D%5Cphi_2(%5Comega-%5Comega_o)%5E2%20%2B%20%5Cfrac%7B1%7D%7B6%7D%5Cphi_3(%5Comega-%5Comega_o)%5E3%20%2B%20%5Cphi_%5Cmathrm%7Bm%7D(%5Comega)%5Ctag%7B34%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20These%20are%3A%0A%20%20%20%20%20%20%20%20-%20%24%5Cphi_%5Cmathrm%7Bce%7D%24%3A%20carrier-envelope%20phase%0A%20%20%20%20%20%20%20%20-%20%24%5Ctau%24%3A%20delay%20(the%20actual%20value%20contains%20an%20offset%20of%20half%20the%20time%20grid%20length%2C%20so%20that%20%24%5Ctau%20%3D%200%24%20means%20the%20pulse%20is%20centered)%0A%20%20%20%20%20%20%20%20-%20%24%5Cphi_2%24%3A%20Group%20delay%20dispersion%20(GDD)%2C%20a.k.a.%20chirp%0A%20%20%20%20%20%20%20%20-%20%24%5Cphi_3%24%3A%20Third%20order%20dispersion%20(TOD)%0A%20%20%20%20%20%20%20%20-%20%24%5Cphi_%5Cmathrm%7Bm%7D(%5Comega)%24%20%3D%20%24%5Cfrac%7Bn_%5Cmathrm%7Bm%7D(%5Comega)%20-%20n_%5Cmathrm%7Bm%7D(%7B%5Comega_o%7D)%7D%7Bc%7D%5Comega%20L%24%2C%20the%20phase%20acquired%20via%20linear%20propagation%20through%20a%20user-selected%20medium%20of%20length%20L.%0A%0A%20%20%20%20%20%20%20%20The%20interactive%20plot%20below%20will%20let%20you%20see%20what%20these%20parameters%20do%20to%20the%20field%20as%20defined%20in%20the%20code%2C%20and%20tell%20you%20the%20full-width-at-half-maximum%20intensity%20(FWHM)%20of%20the%20resulting%20pulse.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20f0%20%3D%20mo.ui.slider(start%3D50%2C%20stop%3D1000%2C%20step%3D10%2C%20value%3D400%2C%20label%3D%22Frequency%22)%0A%20%20%20%20f0%0A%20%20%20%20return%20(f0%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20bandwidth%20%3D%20mo.ui.slider(start%3D2%2C%20stop%3D300%2C%20value%3D80%2C%20label%3D%22Bandwidth%22)%0A%20%20%20%20bandwidth%0A%20%20%20%20return%20(bandwidth%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20Ns%20%3D%20mo.ui.slider(start%3D2%2C%20stop%3D32%2C%20step%3D2%2C%20value%3D2%2C%20label%3D%22SG%20order%22)%0A%20%20%20%20Ns%0A%20%20%20%20return%20(Ns%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20cep%20%3D%20mo.ui.slider(start%3D0.0%2C%20stop%3D2.0%2C%20step%3D0.1%2C%20value%3D0%2C%20label%3D%22CEP%2Fpi%22)%0A%20%20%20%20cep%0A%20%20%20%20return%20(cep%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20tau%20%3D%20mo.ui.slider(start%3D-20%2C%20stop%3D20%2C%20step%3D1%2C%20value%3D0%2C%20label%3D%22Delay%22)%0A%20%20%20%20tau%0A%20%20%20%20return%20(tau%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20phi2%20%3D%20mo.ui.slider(start%3D-100%2C%20stop%3D100%2C%20step%3D1%2C%20value%3D0%2C%20label%3D%22GDD%22)%0A%20%20%20%20phi2%0A%20%20%20%20return%20(phi2%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20phi3%20%3D%20mo.ui.slider(start%3D-300%2C%20stop%3D300%2C%20step%3D1%2C%20value%3D0%2C%20label%3D%22TOD%22)%0A%20%20%20%20phi3%0A%20%20%20%20return%20(phi3%2C)%0A%0A%0A%40app.cell%0Adef%20_(Ns%2C%20bandwidth%2C%20cep%2C%20f0%2C%20lwe%2C%20np%2C%20phi2%2C%20phi3%2C%20plt%2C%20showmo%2C%20tau)%3A%0A%20%20%20%20dt%20%3D%200.25e-15%0A%20%20%20%20Tgrid%20%3D%2080e-15%0A%20%20%20%20Nt%20%3D%20int(2*Tgrid%2Fdt)%0A%20%20%20%20t%20%3D%20np.linspace(-Tgrid%2CTgrid%2CNt)%0A%20%20%20%20w%20%3D%202*np.pi*np.fft.fftfreq(Nt%2Cdt)%0A%20%20%20%20ws%20%3D%20(w-2*np.pi*f0.value*1e12)%0A%20%20%20%20phi%20%3D%20np.pi*cep.value%20%2B%20(-Tgrid%20%2B%20tau.value*1e-15)*w%20%2B%200.5*phi2.value*1e-30*ws**2%20%2B%20(1.0%2F6)*phi3.value*1e-45*ws**3%0A%20%20%20%20Ew%20%3D%20np.exp(-ws**Ns.value%2F(2*np.pi*bandwidth.value*1e12)**Ns.value%20-1.0j%20*%20phi)%0A%20%20%20%20Ew%5Bw%3C0%5D%3D0%0A%20%20%20%20Et%20%3D%20lwe.norma(np.fft.ifft(Ew))%0A%20%20%20%20fwhm_value%20%3D%201e15*lwe.fwhm(t%2Cnp.abs(Et)**2)%0A%20%20%20%20plt.plot(1e15*t%2Cnp.real(Et))%0A%20%20%20%20plt.xlabel(%22Time%20(fs)%22)%0A%20%20%20%20plt.title(f%22FWHM%20duration%3A%20%7Bfwhm_value%3A%20.2f%7D%20fs%22)%0A%20%20%20%20showmo()%0A%20%20%20%20return%20Et%2C%20Ew%2C%20Nt%2C%20Tgrid%2C%20dt%2C%20fwhm_value%2C%20phi%2C%20t%2C%20w%2C%20ws%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%23%23%23%20Numerical%20model%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%23%23%20Propagation%20scheme%2C%20convergence%2C%20stability%0A%0A%20%20%20%20%20%20%20%20The%20numerical%20propagation%20is%20performed%20using%20the%20fourth-order%20Runge-Kutta%20method.%20This%20method%20is%20not%20unconditionally%20stable%2C%20which%20means%20that%20for%20certain%20values%20of%20the%20grid%20parameters%2C%20the%20results%20will%20diverge%2C%20and%20lead%20to%20NaN%20values.%20The%20simulation%20will%20quit%20if%20this%20happens%2C%20and%20tell%20you.%20In%20order%20to%20avoid%20this%2C%20you%20have%20to%20set%20the%20grid%20spacing%20parameters%20correctly%2C%20this%20means%20the%20time%20step%2C%20spatial%20step%20and%20propagation%20step.%0A%0A%20%20%20%20%20%20%20%20Although%20the%20specifics%20of%20how%20these%20schemes%20become%20unstable%20are%20well%20understood%20(see%20the%20Courant-Friedrichs-Lewy%20Condition)%2C%20in%20practice%20it's%20usually%20best%20to%20progressively%20make%20your%20steps%20smaller%20until%20you%20get%20a%20result%2C%20then%20to%20continue%20to%20make%20them%20smaller%20until%20nothing%20changes.%20%0A%0A%20%20%20%20%20%20%20%20A%20step%20of%20the%20RK4%20loop%20of%20the%20calculation%20procedes%20as%20follows%3A%0A%20%20%20%20%20%20%20%201.%20Calculate%20things%20that%20require%20the%20time-domain%20field%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20Nonlinear%20polarization%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20Plasma%20currents%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20Radial%20Laplacian%20(if%20in%20cylindrical%20coordinates)%0A%20%20%20%20%20%20%20%202.%20Use%20results%20of%201%2C%20and%20prepared%20linear%20propagation%20frequency-domain%20factors%2C%20to%20provide%20an%20estimate%20of%20the%20field%20after%201%2F2%20a%20propagation%20step%0A%20%20%20%20%20%20%20%203.%20Repeat%201%20with%20the%20new%20field%0A%20%20%20%20%20%20%20%204.%20Update%20the%201%2F2%20step%20estimate%20with%20the%20new%20polarization%0A%20%20%20%20%20%20%20%205.%20Repeat%201%20with%20the%20new%20field%0A%20%20%20%20%20%20%20%206.%20Estimate%20the%20final%20step%20field%20with%20the%20results%0A%20%20%20%20%20%20%20%207.%20Repeat%201%20with%20the%20new%20field%0A%20%20%20%20%20%20%20%208.%20Step%20to%20the%20next%20propagation%20step%20using%20the%20steps%20calculated%20from%201-7%0A%0A%20%20%20%20%20%20%20%20You%20can%20see%20that%20this%20requires%20the%20polarizations%20to%20be%20evaluated%204%20times%20in%20order%20to%20advance%20one%20propagation%20step.%20This%20is%20more%20effort%20per%20step%20than%20using%20the%20%22split%20step%20method%22%20you'll%20hear%20old%20textbooks%20talk%20about%2C%20but%20ends%20up%20being%20much%20more%20accurate%20in%20practical%20calculations.%0A%0A%20%20%20%20%20%20%20%20When%20the%20pulse%20is%20propagated%20in%20Cartesian%20coordinates%2C%20the%20field%20is%20propagated%20in%20a%20basis%20of%20states%20comprising%20the%20plane-wave%20solutions%20to%20Fourier%20optics%20as%20the%20beam%20propagates%20along%20the%20z-direction%2C%20whose%20projection%20into%20real%20space%20(needed%20to%20obtain%20the%20nonlinear%20polarization%2C%20for%20example)%20is%20given%20by%20the%20standard%20Fourier%20optics%20propagator%3A%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20E(%5Cmathbf%7Bx%7D%20%2B%20z%5Chat%7Bz%7D%2C%5Comega)%20%3D%20e%5E%7Bi%20k_z%20z%7D%20E(%5Cmathbf%7Bx%7D%2C%5Comega)%2C%5Ctag%7B35%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20where%0A%0A%20%20%20%20%20%20%20%20%24%24%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20k_z%20%3D%20%5Csqrt%7B%7Ck%7C%5E2%20-%20k_x%5E2%20-%20k_y%5E2%7D%5Ctag%7B36%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%20%20%20%20%20%20%20%20%24%24%0A%0A%20%20%20%20%20%20%20%20The%20nonlinear%20wave%20equation%20is%20significantly%20simplified%20in%20this%20basis%2C%20with%20all%20of%20the%20linear%20propagation%20terms%2C%20including%20diffraction%2C%20becoming%20zero.%20The%20linear%20propagation%20is%20handled%20exactly%20by%20the%20evolution%20of%20the%20basis%20states%20since%20we%20use%20the%20Fourier%20solution%2C%20such%20that%20only%20the%20nonlinear%20buildup%20has%20to%20be%20handled%20numerically.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%23%23%20Cylindrical%20symmetry%20tricks%0A%0A%20%20%20%20%20%20%20%20When%20the%20beam%20can%20be%20assumed%20to%20be%20symmetric%20around%20the%20z-axis%2C%20we%20can't%20use%20the%20Fourier%20basis%2C%20but%20we%20can%20still%20simplify%20things%20(and%20speed%20up%20the%20simulation)%20a%20lot%2C%20since%20the%20grid%20can%20be%20reduced%20from%203%20dimensions%2C%20%24(x%2C%20y%2C%20t)%24%2C%20to%202%2C%20%24(%5Crho%2C%20t)%24.%20%0A%0A%20%20%20%20%20%20%20%20The%20only%20thing%20that%20makes%20life%20more%20difficult%20after%20this%20coordinate%20transformation%20is%20the%20transverse%20Laplacian%20from%20eqn.%20(1).%20In%20cylindrical%20coordinates%20with%20radial%20symmetry%2C%20it%20becomes%0A%0A%20%20%20%20%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cnabla%5E2_%5Cperp%20%3D%20%5Cfrac%7B%5Cpartial%5E2%7D%7B%5Cpartial%20%5Crho%5E2%7D%20%2B%20%5Cfrac%7B1%7D%7B%5Crho%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20%5Crho%7D%20%5Ctag%7B37%7D%0A%20%20%20%20%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20%20%20%20%20Compared%20to%20a%20Cartesian%20coordinate%2C%20we%20have%20an%20extra%20term%20to%20deal%20with.%20And%20unfortunately%2C%20unlike%20Cartesian%20coordinates%2C%20that%20term%20is%20not%20a%20diagonal%20operator%20in%20the%20Fourier%20domain.%0A%0A%20%20%20%20%20%20%20%20One%20approach%20is%20to%20make%20a%20Hankel%20transform%20instead%20of%20a%20Fourier%20transform%2C%20in%20which%20case%20the%20operator%20will%20be%20diagonal.%20Numerically%20this%20can%20be%20implemented%20in%20a%20fairly%20efficient%20way%20leveraging%20FFTs%2C%20but%20only%20if%20the%20data%20is%20arranged%20on%20a%20logarithmic%20grid.%0A%0A%20%20%20%20%20%20%20%20Another%20way%20is%20to%20use%20an%20evenly%20spaced%20grid%2C%20but%20explicitly%20calculate%20the%20%24%5Cfrac%7B1%7D%7B%5Crho%7D%24%20term%20in%20real%20space.%20This%20way%20one%20uses%20FFTs%20and%20the%20same%20grid%20as%20the%20calculations%20in%20Cartesian%20coordinates%2C%20but%20with%20the%20expense%20of%20having%20to%20do%20a%20Fourier%20transform%20at%20each%20propagation%20step.%20Since%20we%20have%20to%20do%20that%20anyway%20for%20the%20inclusion%20of%20nonlinearities%2C%20it's%20not%20a%20big%20deal%20in%20this%20case.%0A%0A%20%20%20%20%20%20%20%20The%20grid%20used%20in%20this%20case%20extends%20to%20the%20negative%20side%20of%20the%20origin%2C%20so%20that%20the%20FFT%20doesn't%20see%20a%20discontinuity%20at%20%24%5Crho%20%3D%200%24%2C%20covering%20the%20range%20%24-%5Crho_%7B%5Ctextrm%7Bmax%7D%7D%24%20to%20%24%2B%5Crho_%7B%5Ctextrm%7Bmax%7D%7D%24.%20This%20would%20seem%20to%20be%20a%20waste%20of%20memory%20since%20the%20positive%20and%20negative%20sides%20of%20the%20origin%20are%20identical%20by%20symmetry.%0A%0A%20%20%20%20%20%20%20%20If%20we%20use%20a%20grid%20that%20is%20truly%20symmetric%2C%20that%20is%20indeed%20the%20case%3A%20we%20would%20be%20solving%20everything%20at%20%24%5Crho%20%3D%20...%20-3%2C%20-2%2C%20-1%2C%200%2C%20%2B1%2C%20%2B2%2C%20%2B3...%24%20etc.%0A%0A%20%20%20%20%20%20%20%20However%2C%20what%20if%20we%20shift%20the%20placement%20of%20our%20grid%20points%20by%20%24%5Cfrac%7B1%7D%7B4%7D%24%3F%20Now%20we%20have%20the%20fields%20at%20%24%5Crho%20%3D%20...%20-2%5Cfrac%7B3%7D%7B4%7D%2C%20-1%5Cfrac%7B3%7D%7B4%7D%2C%20-%5Cfrac%7B3%7D%7B4%7D%2C%20%2B%5Cfrac%7B1%7D%7B4%7D%2C%20%2B1%5Cfrac%7B1%7D%7B4%7D%2C%20%2B2%5Cfrac%7B1%7D%7B4%7D%2C%20%2B3%5Cfrac%7B1%7D%7B4%7D%24%0A%0A%20%20%20%20%20%20%20%20This%20way%2C%20the%20positive%20and%20negative%20sides%20of%20the%20grid%20have%20different%20information%3A%20the%20previously-useless%20negative-%24%5Crho%24%20values%20contain%20the%20midpoints%20between%20the%20points%20on%20the%20positive%20%24%5Crho%24%20grid.%20The%20spacing%20is%20still%201%20however%2C%20meaning%20that%20the%20grid%20doesn't%20include%20high%20values%20of%20the%20transverse%20%24k%24%2C%20which%20often%20bring%20numerical%20instability%2C%20in%20order%20to%20get%20doubled%20resolution%20in%20space.%20We%20just%20have%20to%20%22interlace%22%20the%20grid%20using%20our%20knowledge%20of%20the%20symmetry%20of%20the%20system.%20%0A%0A%20%20%20%20%20%20%20%20We%20make%20use%20of%20this%20in%20two%20places%20in%20the%20cylindrical%20symmetry%20propagation%20mode%3A%20to%20eliminate%20_aliasing_%20in%20the%20calculation%20of%20the%20nonlinear%20polarization%2C%20and%20to%20improve%20the%20accuracy%20of%20the%20finite-difference%20calculation%20of%20the%20radial%20derivative%20included%20in%20that%20%24%5Cfrac%7B1%7D%7B%5Crho%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20%5Crho%7D%24%20term%20of%20the%20Laplacian.%0A%0A%20%20%20%20%20%20%20%20This%20results%20in%20overall%20easier%20convergence%20of%20calculations%20in%20cylindrical%20symmetry%20mode%2C%20which%20is%20why%20it's%20a%20good%20place%20to%20start%20when%20approaching%20a%20new%20system.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%23%20Interface%0A%0A%20%20%20%20%20%20%20%20Here%20is%20a%20view%20of%20the%20user%20interface%2C%20with%20significant%20parts%20labeled%20in%20the%20large%20colored%20text%0A%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22https%3A%2F%2Fraw.githubusercontent.com%2FNickKarpowicz%2FLightwaveExplorer%2Frefs%2Fheads%2Fmaster%2FDocumentation%2FImages%2FLabeledInterface.svg%22%3E%0A%0A%20%20%20%20%20%20%20%20Let's%20go%20through%20these%20components%20one-by-one.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%20Pulse%20parameters%0A%20%20%20%20%20%20%20%20These%20you%20find%20in%20two%20columns%20on%20the%20left.%20Here%20you%20can%20put%20in%20all%20the%20parameters%20described%20in%20the%20Pulse%20Parameters%20section%2C%20plus%20a%20few%20more.%0A%20%20%20%20%20%20%20%201.%20Pulse%20energy%3A%20total%20energy%20contained%20in%20the%20pulse%3B%20the%20intensity%20will%20be%20determined%20by%20this%20value%0A%20%20%20%20%20%20%20%202.%20Frequency%3A%20%24f_0%24%20as%20defined%20above%2C%20in%20THz%0A%20%20%20%20%20%20%20%203.%20Bandwidth%3A%20%24%5CDelta_%5Comega%24%20as%20defined%20above%2C%20in%20THz%0A%20%20%20%20%20%20%20%204.%20SG%20order%3A%20%24N_s%24%20as%20defined%20above%2C%20giving%20the%20order%20of%20the%20supergaussian%20to%20use.%202%20is%20a%20normal%20gaussian.%20Only%20even%20values%20are%20allowed.%0A%20%20%20%20%20%20%20%205.%20CEP%2F%24%5Cpi%24%3A%20%24%5Cphi_0%24%20as%20defined%20above%2C%20the%20carrier-envelope%20phase.%20In%20units%20of%20radians%2F%24%5Cpi%24%2C%20e.g.%20a%20value%20of%201%20will%20invert%20the%20field.%0A%20%20%20%20%20%20%20%206.%20Delay%3A%20%24tau%24%2C%20in%20fs.%20Allows%20you%20to%20move%20your%20pulse%20around%20the%20grid%20-%20negative%20values%20move%20it%20earlier%20in%20time.%0A%20%20%20%20%20%20%20%207.%20GDD%3A%20%24%5Cphi_2%24%2C%20the%20group%20delay%20dispersion%2C%20in%20fs%20%24%5E2%24%0A%20%20%20%20%20%20%20%207.%20GDD%3A%20%24%5Cphi_3%24%2C%20the%20third%20order%20dispersion%2C%20in%20fs%20%24%5E3%24%0A%20%20%20%20%20%20%20%208.%20Phase%20material%3A%20You%20can%20select%20from%20the%20loaded%20material%20in%20the%20crystal%20database%2C%20shown%20in%20the%20info%20box%2C%20a%20material%20whose%20dispersion%20you%20would%20like%20to%20apply%20to%20the%20pulse.%20For%20example%2C%20if%20you%20leave%20it%20as%202%2C%20it%20will%20apply%20the%20phase%20of%20passing%20through%20BaF2.%0A%20%20%20%20%20%20%20%209.%20Thickness%3A%20Thickness%20in%20microns%20of%20the%20phase%20material%20to%20apply.%20If%20you%20set%20it%20to%201000%2C%20the%20pulse%20will%20be%20stretched%20(or%20compressed)%20as%20though%20it%20passed%20through%201%20mm%20of%20barium%20fluoride.%20Negative%20values%20would%20allow%20you%20to%20precompensate%20for%20the%20dispersion.%0A%20%20%20%20%20%20%20%2010.%20Beamwaist%3A%20The%20Gaussian%20waist%20%24w_o%24.%20This%20is%20not%20necessarily%20the%20size%20of%20the%20beam%20at%20the%20start%20of%20the%20simulation%2C%20but%20what%20size%20the%20focus%20will%20have%20when%20the%20beam%20reaches%20in%20via%20linear%20propagation.%0A%20%20%20%20%20%20%20%2011.%20x%20offset%3A%20amount%20by%20which%20to%20shift%20the%20beam%20on%20the%20spatial%20grid.%20Will%20always%20be%200%20when%20radial%20symmetry%20is%20applied.%0A%20%20%20%20%20%20%20%2012.%20z%20offset%3A%20amount%20by%20which%20to%20shift%20the%20beam%20relative%20to%20the%20propagation%20coordinate.%200%20means%20that%20the%20beam%20is%20focused%20at%20the%20beginning%20of%20the%20simulation.%20If%20it%20is%20negative%2C%20it%20will%20be%20diverging%20as%20the%20simulation%20starts%2C%20and%20if%20it's%20positive%2C%20it%20will%20be%20converging.%0A%20%20%20%20%20%20%20%2013.%20NC%20angle%3A%20Noncollinear%20angle%20of%20the%20beam.%20If%20it%20is%200%2C%20the%20beam%20will%20be%20pointing%20along%20the%20z-axis.%0A%20%20%20%20%20%20%20%2014.%20Polarization%3A%20Angle%20in%20degrees%20of%20the%20field%20direction%20relative%20to%20the%20x-y%20plane.%200%20means%20the%20field%20is%20along%20the%20x%20axis%2C%2090%20means%20it%20is%20along%20the%20y%20axis.%0A%20%20%20%20%20%20%20%2015.%20Circularity%3A%20degree%20of%20ellipticity%20of%20the%20field.%200%20means%20linearly%20polarized%2C%201%20means%20circular.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20Grid%20parameters%0A%20%20%20%20%20%20%20%20These%20describe%20the%20propagation%20space%20of%20the%20pulse.%0A%0A%20%20%20%20%20%20%20%201.%20Material%20index%3A%20first%20column%20is%20the%20number%20of%20the%20material%20(from%20the%20list%20of%20loaded%20database%20entries%20displayed%20in%20the%20info%20box%20when%20the%20program%20starts).%20Second%20column%20is%20an%20alternate%20material%20to%20be%20applied%20in%20certain%20special%20modes.%0A%20%20%20%20%20%20%20%202.%20Theta%2C%20phi%3A%20the%20crystal%20propagation%20angles%20in%20degrees.%20They%20select%20the%20phase%20matching%20and%20nonlinear%20coefficients%20of%20the%20interaction.%0A%20%20%20%20%20%20%20%203.%20NL%20absorption%3A%20The%20parameters%20describing%20the%20nonlinear%20absorption%3B%20%24%5Cbeta%24%20(in%20units%20determined%20by%20the%20order%20of%20the%20interaction)%2C%20and%20%24%5CDelta_g%24%20(in%20eV).%0A%20%20%20%20%20%20%20%204.%20Drude%20model%20parameters%3A%20the%20momentum%20relaxation%20time%20%24%5Cgamma%24%20and%20the%20reduced%20effective%20mass%20%24%5Cmu%24%0A%20%20%20%20%20%20%20%205.%20Grid%20width%2C%20dx%3A%20the%20size%20and%20resolution%20of%20the%20spatial%20grid%2C%20respectively.%20In%20microns.%0A%20%20%20%20%20%20%20%206.%20Time%20span%2C%20dt%3A%20The%20length%20and%20resolution%20of%20the%20temporal%20grid%2C%20in%20fs.%0A%20%20%20%20%20%20%20%207.%20Length%2C%20dz%3A%20How%20far%20to%20propagate%2C%20and%20the%20spatial%20step%20size%20of%20the%20simulation%2C%20in%20microns.%0A%20%20%20%20%20%20%20%208.%20Propagation%20mode%3A%20select%20between%20full%203D%2C%20radial%20symmetry%20mode%2C%20or%202D%20cartesian%20coordinates.%0A%20%20%20%20%20%20%20%209.%20Batch%20mode%3A%20This%20is%20a%20bit%20complicated%2C%20but%20it%20allows%20you%20to%20run%20a%20sequence%20of%20simulations%2C%20sweeping%20one%20variable.%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20first%2C%20select%20from%20the%20drop%20down%20the%20parameter%20you%20wish%20to%20change.%20The%20pulse%20and%20material%20properties%20you%20set%20with%20floating%20point%20values%20are%20all%20adjustable%20here.%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20in%20%22batch%20end%22%20put%20the%20value%20to%20which%20it%20should%20sweep%2C%20in%20the%20same%20units%20as%20the%20initial%20value%20you%20gave.%20For%20example%2C%20if%20%22Delay%22%20on%20the%20left-hand-side%20of%20the%20interface%20is%20set%20to%20%22-50%22%2C%20and%20you%20put%20%2250%22%20in%20the%20%22Batch%20end%22%20box%2C%20the%20series%20will%20go%20from%20-50%20to%2050.%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20in%20Batch%20steps%2C%20put%20the%20number%20of%20steps%20in%20the%20sweep.%20If%20it%20is%201%2C%20only%20the%20initial%20value%20will%20be%20used.%20If%20it%20is%20zero%20or%20less%2C%20it%20will%20set%20itself%20to%201.%0A%20%20%20%20%20%20%20%2010.%20Batch%20mode%202%20works%20the%20same%20way%2C%20but%20uses%20the%20values%20in%20the%20second%20column%20for%20batch%20end%20and%20batch%20steps.%20If%20you%20use%20both%2C%20you%20can%20do%20a%202D%20parameter%20scan.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%23%20Using%20sequences%0A%0A%20%20%20%20%20%20%20%20Below%20the%20batch%20mode%2C%20you'll%20find%20a%20text%20box%20labelel%20%22Crystal%20sequence%22.%20This%20is%20where%20you%20can%20program%20in%20a%20more%20complex%20series%20of%20events%20to%20take%20place%20rather%20than%20simply%20propagate%20through%20one%20crystal.%0A%0A%20%20%20%20%20%20%20%20You%20can%20program%20a%20variety%20of%20things%20to%20happen%2C%20and%20utilize%20for%20loops%20and%20variables%20to%20simulated%20complicated%20systems.%0A%0A%20%20%20%20%20%20%20%20The%20syntax%20is%20similar%20to%20c%2Fc%2B%2B%20-%20you%20can%20write%20out%20a%20series%20of%20functions%2C%20applying%20white%20space%20as%20you%20see%20fit.%20Semicolons%20are%20not%20necessary%20after%20function%20calls%2C%20but%20you%20can%20add%20them%20if%20you%20want.%20%0A%0A%20%20%20%20%20%20%20%20Here's%20an%20example%20of%20a%20sequence%20making%20use%20of%20loops%20in%20order%20so%20simulate%20a%20periodically-poled%20lithium%20niobate%20(PPLN)%20crystal%2C%20with%20two%20different%20periods%20along%20the%20propagation%20direction%3A%0A%0A%20%20%20%20%20%20%20%20%60%60%60%0A%20%20%20%20%20%20%20%20%20%20%20%20set(1%2C14.6)%0A%20%20%20%20%20%20%20%20%20%20%20%20for(0.5*500%2Fv01%2C0)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nonlinear(d%2Cd%2Cd%2Cv1%2Cd)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rotate(180)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20for(17%2C0)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nonlinear(d%2Cd%2Cd%2C9.25%2Cd)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rotate(180)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%60%60%60%0A%0A%20%20%20%20%20%20%20%20Let's%20go%20through%20what%20the%20different%20terms%20mean.%0A%0A%20%20%20%20%20%20%20%20First%20we%20have%20the%20set()%20function.%20This%20is%20defined%20further%20below%2C%20but%20in%20short%20it%20allows%20you%20to%20assign%20a%20value%20to%20a%20variable.%20You%20can%20access%20up%20to%20100%20variables%20(named%20v00%20to%20v99)%20if%20you%20want%20to%20-%20which%20one%20you%20access%20is%20the%20first%20parameter%20in%20the%20function%20call.%20The%20second%20parameter%20of%20the%20call%20is%20what%20you%20set%20it%20to.%20So%20in%20this%20case%2C%20we%20are%20setting%20the%20variable%20v01%20to%2014.6.%0A%0A%20%20%20%20%20%20%20%20Next%2C%20we%20have%20a%20for%20loop.%20The%20syntax%20of%20a%20for%20loop%20takes%20two%20parameters%3A%20first%2C%20the%20number%20of%20iterations%2C%20second%2C%20the%20variable%20in%20which%20to%20store%20the%20counter.%20This%20for%20loop%20will%20loop%20over%200.5*500%2Fv1%20iterations%2C%20which%20means%20that%20it%20is%20reading%20the%20variable%20set%20in%20the%20previous%20line%20(v1)%20to%20determine%20how%20many%20times%20to%20run.%20This%20is%20so%20the%20loop%20can%20run%20over%20a%20fixed%20PPLN%20thickness%20instead%20of%20a%20fixed%20number%20of%20periods.%20The%20variable%20v0%20will%20contain%20the%20index%20of%20the%20for%20loop%20(i.e.%20how%20many%20times%20it%20has%20run%2C%20starting%20from%200).%20This%20isn't%20used%20here%2C%20but%20could%20for%20example%20be%20used%20to%20make%20a%20chirped%20PPLN.%0A%0A%20%20%20%20%20%20%20%20Next%2C%20we%20have%20the%20nonlinear()%20function.%20This%20runs%20the%20nonlinear%20propagation%2C%20as%20given%20in%20the%20function%20definition%20below.%20You%20might%20notice%20that%20a%20lot%20of%20the%20parameters%20just%20have%20'd'%20instead%20of%20a%20number.%20This%20tells%20the%20interpreter%20just%20to%20take%20the%20default%20value%20of%20the%20parameter%2C%20i.e.%20to%20take%20the%20value%20given%20by%20the%20interface.%20Any%20value%20with%20d%20will%20be%20able%20to%20be%20scanned%20in%20a%20batch%20mode%20or%20changed%20by%20the%20fitting%20routine%2C%20as%20it%20will%20be%20tied%20to%20the%20currently%20active%20value.%0A%0A%20%20%20%20%20%20%20%20Following%20that%20is%20the%20rotate()%20function%2C%20which%20rotates%20the%20field%20relative%20to%20the%20crystal.%20From%20the%20field's%20point-of-view%2C%20it's%20like%20the%20orientation%20of%20the%20crystal%20was%20flipped%20upside%20down%2C%20allowing%20quasi-phasematching%20to%20work.%0A%0A%20%20%20%20%20%20%20%20The%20for%20loop%20is%20then%20closed%20by%20curly%20brackets%2C%20and%20another%20one%20starts%2C%20doing%20the%20same%20thing%2C%20over%2017%20iterations%20with%20half-period%20of%209.25%20microns.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20Variables%0A%0A%20%20%20%20%20%20%20%20There%20are%20three%20types%20of%20variables%20that%20can%20be%20accessed%3A%20iXX%2C%20vXX%20and%20d.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%23%20iXX%0A%20%20%20%20%20%20%20%20These%20are%20interface%20variables%2C%20which%20correspond%20to%20the%20parameters%20that%20are%20set%20by%20the%20interface.%20They%20are%20called%20by%20the%20letter%20i%20followed%20by%20a%20number%2C%20where%20the%20number%20is%20the%20identifier%20of%20the%20associated%20batch%20mode.%20That%20is%2C%20the%20number%20you%20can%20see%20in%20the%20pull-down%20menu%20when%20selecting%20which%20parameter%20to%20scan%20for%20a%20batch.%20So%2C%20for%20example%2C%20i01%20will%20give%20you%20the%20pulse%20energy%20in%20Joules.%20Setting%20the%20length%20of%20a%20crystal%20to%20i34%5E2%20will%20cause%20its%20length%20to%20be%20the%20square%20of%20the%20length%20(in%20microns)%20as%20entered%20on%20the%20interface.%20%0A%0A%20%20%20%20%20%20%20%20Currently%20the%20values%20of%20the%20iXX%20variables%20cannot%20be%20changed%20from%20within%20the%20sequence.%20They%20might%20do%20so%20if%20I%20can%20convince%20myself%20it%20won't%20lead%20to%20any%20disasters.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%23%20vXX%0A%20%20%20%20%20%20%20%20These%20are%20user-controlled%20variables.%20You%20can%20set%20them%20to%20whatever%20you%20want%20with%20the%20set()%20function%3A%20set(2%2Ci34)%20will%20set%20the%20value%20of%20v02%20to%20the%20length%20of%20the%20crystal.%20You%20can%20use%20them%20later%20to%20determine%20input%20parameters%20of%20functions.%20They%20start%20with%20their%20values%20initialized%20to%20zero%2C%20so%20that's%20what%20they'll%20be%20if%20you%20use%20them%20without%20setting%20them.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%23%20d%0A%20%20%20%20%20%20%20%20The%20keyword%20d%20will%20set%20the%20input%20parameter%20of%20a%20function%20to%20the%20corresponding%20value%20of%20the%20interface.%20If%20you%20call%20a%20nonlinear%20crystal%20with%20nonlinear(d%2Cd%2Cd%2Cd%2Cd)%2C%20its%20material%20index%2C%20%24%5Ctheta%24%2C%20%24%5Cphi%24%2C%20thickness%20and%20propagation%20step%20will%20just%20be%20whatever%20is%20on%20the%20interface%2C%20after%20being%20potentially%20modified%20by%20a%20batch%20scan%20or%20fitting%20command.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%20Functions%0A%20%20%20%20%20%20%20%20A%20number%20of%20functions%20are%20available%20for%20sequences.%20They%20are%20defined%20here.%20In%20order%20to%20initialize%20the%20electric%20field%20grid%2C%20a%20subset%20of%20functions%20must%20be%20called%20at%20least%20once%20before%20other%20functions%20which%20only%20modify%20the%20field%20grid%20are%20called.%20See%20the%20definition%20to%20know%20which%20type%20you're%20dealing%20with.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20plasma(materialIndex%2C%20crystalTheta%2C%20crystalPhi%2C%20nonlinearAbsorptionStrength%2C%20bandGapElectronVolts%2C%20drudeGamma%2C%20effectiveMass%2C%20crystalThickness%2C%20propagationStep)%0A%20%20%20%20%20%20%20%20This%20function%20runs%20a%20nonlinear%20propagation%20through%20a%20medium%20determined%20by%20materialIndex.%0A%0A%20%20%20%20%20%20%20%20A%20call%20to%20plasma()%20will%20initialize%20the%20electric%20field%20grid%20if%20it%20hasn't%20been%20done%20so%20already.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20nonlinear(materialIndex%2C%20crystalTheta%2C%20crystalPhi%2C%20crystalThickness%2C%20propagationStep)%0A%20%20%20%20%20%20%20%20This%20function%20will%20run%20a%20propagation%20through%20a%20medium%20determined%20by%20materialIndex%2C%20but%20with%20no%20nonlinear%20absorption%20or%20plasma%20formation.%0A%0A%20%20%20%20%20%20%20%20A%20call%20to%20nonlinear()%20will%20initialize%20the%20electric%20field%20grid%20if%20it%20hasn't%20been%20done%20so%20already.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20default()%0A%20%20%20%20%20%20%20%20This%20function%20will%20run%20a%20nonlinear%20propagation%20through%20the%20medium%20selected%20on%20the%20interface%2C%20taking%20all%20values%20from%20the%20interface.%20It%20is%20equivalent%20to%20calling%20plasma(d%2Cd%2Cd%2Cd%2Cd%2Cd%2Cd%2Cd%2Cd).%0A%0A%20%20%20%20%20%20%20%20A%20call%20to%20default()%20will%20initialize%20the%20electric%20field%20grid%20if%20it%20hasn't%20been%20done%20so%20already.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20init()%0A%20%20%20%20%20%20%20%20This%20function%20will%20create%20the%20electric%20fields%20in%20vacuum.%20This%20is%20useful%20if%20you%20want%20to%20simulate%20how%20the%20fields%20refract%20as%20they%20enter%20the%20crystal%20of%20interest.%20It's%20equivalent%20to%20calling%20nonlinear(0%2C0%2C0%2C0%2C1).%0A%0A%20%20%20%20%20%20%20%20A%20call%20to%20init()%20will%20initialize%20the%20electric%20field%20grid%20if%20it%20hasn't%20been%20done%20so%20already.%20That's%20probably%20the%20only%20reason%20you'd%20want%20to%20call%20it.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20addPulse(energy%2C%20frequency%2C%20bandwidth%2C%20sgOrder%2C%20cep%2C%20delay%2C%20gdd%2C%20tod%2C%20phaseMaterial%2C%20phaseThickness%2C%20beamwaist%2C%20x0%2C%20y0%2C%20z0%2C%20beamAngle%2C%20beamAngleY%2C%20polarization%2C%20circularity%2C%20materialIndex%2C%20theta%2C%20phi)%0A%20%20%20%20%20%20%20%20This%20will%20add%20a%20new%20pulse%20to%20the%20grid%2C%20using%20all%20of%20the%20parameters%20of%20the%20interface.%20Note%20that%20you%20also%20have%20to%20specify%20the%20material%20in%20which%20the%20pulse%20is%20being%20created.%20%0A%0A%20%20%20%20%20%20%20%20You%20can%20repeat%20this%20as%20many%20times%20as%20you%20want%2C%20to%20create%20many%20pulses.%0A%0A%20%20%20%20%20%20%20%20Note%20that%20compared%20to%20the%20interface%2C%20you%20have%20an%20extra%20beam%20angle%20and%20beam%20position.%20These%20are%20only%20relevant%20to%203D%20calculations%20and%20gives%20the%20angle%20and%20offset%20in%20the%20y-direction.%20(you%20can%20actually%20specify%20them%20on%20the%20interface%2C%20too%2C%20by%20writing%20both%20angles%20in%20the%20text%20box%20separated%20by%20a%20semicolon%20in%20the%20box%20for%20x0%20and%20the%20NC%20angle%2C%20e.g.%2010%3B20%20will%20give%20an%20x-direction%20value%20of%2010%20and%20a%20y-direction%20value%20of%2020).%0A%0A%20%20%20%20%20%20%20%20A%20call%20to%20addPulse()%20will%20initialize%20the%20electric%20field%20grid%20if%20it%20hasn't%20been%20done%20so%20already.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20linear(materialIndex%2C%20crystalTheta%2C%20crystalPhi%2C%20crystalThickness%2C%20propagationStep)%0A%20%20%20%20%20%20%20%20This%20function%20will%20propagate%20*linearly*%20through%20the%20medium%20determined%20by%20materialIndex.%20The%20parameter%20propagationStep%20is%20only%20necessary%20when%20in%20cylindrical%20symmetry%20mode.%20This%20is%20because%20the%20propagation%20is%20carried%20out%20analytically%20in%203D%20and%202D%20Cartesian%20modes%20since%20the%20linear%20propagator%20is%20diagonal%20in%20those%20bases.%20In%20cylindrical%20symmetry%20mode%2C%20it%20is%20handled%20as%20a%20numerical%20propagation%20with%20all%20nonlinearities%20disabled%2C%20which%20is%20why%20specifying%20a%20step%20size%20is%20necessary.%20This%20is%20also%20why%20this%20function%20is%20significantly%20faster%20in%203D%20and%202D%20Cartesian%20coordinates.%0A%0A%20%20%20%20%20%20%20%20This%20function%20will%20*not*%20initialize%20the%20grid%20-%20it%20is%20necessary%20to%20precede%20it%20with%20one%20that%20does.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20rotate(angle)%0A%20%20%20%20%20%20%20%20This%20will%20rotate%20the%20electric%20field%20around%20its%20propagation%20axis%20by%20an%20angle%20of%20its%20input%20parameter%20in%20degrees.%20For%20example%2C%20rotate(90)%20will%20change%20s-polarized%20light%20to%20p-polarized%20light.%0A%0A%20%20%20%20%20%20%20%20This%20function%20will%20*not*%20initialize%20the%20grid%20-%20it%20is%20necessary%20to%20precede%20it%20with%20one%20that%20does.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20rotateIntoBiaxial(materialIndex%2C%20crystalTheta%2C%20crystalPhi%2C%20frequency)%0A%20%20%20%20%20%20%20%20This%20will%20rotate%20the%20field%20by%20the%20angle%20%24%5Cdelta%24%20defined%20above%20in%20the%20context%20of%20the%20refractive%20index%20ellipse%20for%20biaxial%20crystals%2C%20aligning%20the%20polarization%20axes%20of%20the%20beam%20to%20the%20refractive%20index%20ellipse%20for%20the%20input%20material%2C%20crystal%20angles%2C%20and%20frequency.%20The%20similar%20function%20rotateFromBiaxial()%20will%20rotate%20in%20the%20opposite%20direction%2C%20and%20should%20be%20applied%20after%20propagation.%0A%0A%20%20%20%20%20%20%20%20This%20function%20will%20*not*%20initialize%20the%20grid%20-%20it%20is%20necessary%20to%20precede%20it%20with%20one%20that%20does.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20fdtd(timeFactor%2C%20dz%2C%20frontSpacer%2C%20backSpacer%2C%20obervationPlane%2C%20waitTime%2C%20preserveNearField%2C%20loadedGridIndex)%0A%20%20%20%20%20%20%20%20This%20will%20use%20finite%20difference%20time%20domain%20(FDTD)%20mode%20with%20more%20fine-grained%20control%20over%20the%20system.%20The%20input%20parameters%20are%20as%20follows%3A%0A%20%20%20%20%20%20%20%20%20-%20timeFactor%3A%20the%20difference%20in%20time-step%20between%20the%20saved%20data%20the%20one%20put%20in%20as%20dt%20on%20the%20interface%2C%20and%20the%20one%20used%20in%20the%20FDTD%20simulation.%20For%20example%2C%20if%20the%20value%20is%205%2C%20and%20dt%20on%20the%20interface%20is%20125%20attoseconds%2C%20the%20time%20step%20in%20the%20simulation%20will%20be%2025%20as.%20Default%20value%3A%205%0A%20%20%20%20%20%20%20%20%20-%20dz%3A%20the%20spatial%20step%20along%20the%20z-direction%20to%20use.%20Default%3A%20value%20entered%20on%20the%20interface.%0A%20%20%20%20%20%20%20%20%20-%20frontSpacer%3A%20if%20propagating%20to%20a%20crystal%2C%20place%20this%20distance%20in%20vacuum%20(meters)%20in%20front%20of%20the%20surface%2C%20so%20that%20the%20light%20doesn't%20immediately%20hit%20the%20crystal%20at%20the%20edge%20of%20the%20grid.%20Default%20value%201e-6%20m%0A%20%20%20%20%20%20%20%20%20-%20backSpacer%3A%20place%20this%20distance%20(m)%20after%20the%20crystal%20before%20the%20edge%20of%20the%20grid%20(e.g.%20extend%20the%20grid%20in%20the%20z-direction%20by%20this%20amount).%20Default%3A%201e-6%20m.%0A%20%20%20%20%20%20%20%20%20-%20observationPlane%3A%20The%20location%20(meters)%20within%20the%20numerical%20grid%20to%20record%20the%20field%20as%20a%20function%20of%20time.%20The%20field%20is%20recorded%20in%20a%20plane%20whose%20surface%20normal%20is%20the%20z-axis.%200%20is%20the%20front%20surface%20of%20the%20grid.%0A%20%20%20%20%20%20%20%20%20-%20waitTime%3A%20time%20(s)%20to%20let%20the%20simulation%20progress%20before%20recording%20the%20field%20in%20the%20observation%20plane.%20This%20is%20useful%20to%20not%20have%20a%20long%20period%20of%20zero%20field%20before%20the%20field%20from%20the%20start%20of%20the%20grid%20reaches%20the%20observation%20plane.%20Default%200.%0A%20%20%20%20%20%20%20%20%20-%20preserveNearField%3A%201%20or%200.%201%20will%20keep%20the%20field%20as%20it%20was%20during%20the%20simulation%2C%200%20will%20filter%20out%20spatial%20frequencies%20which%20will%20not%20propagate%20to%20the%20far-field.%0A%20%20%20%20%20%20%20%20%20-%20loadedGridIndex%3A%20if%20you%20have%20loaded%20a%20material%20map%20from%20a%20file%2C%20this%20should%20be%20the%20index%20of%20that%20file%20in%20the%20loaded%20optics%20database.%20If%20you%20set%20this%20to%20d%2C%20it%20will%20instead%20construct%20a%20flat%20crystal%20in%20the%20center%20of%20the%20grid%2C%20sandwiched%20between%20vacuum%20spacers%20given%20by%20frontSpacer%20and%20backSpacer.%0A%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20fdtdReflection(timeFactor%2C%20dz)%0A%20%20%20%20%20%20%20%20This%20is%20a%20streamlined%20version%20of%20the%20fdtd%20function%20for%20calculating%20the%20reflection%20from%20the%20surface%20of%20a%20crystal.%20The%20input%20parameters%20are%20just%20the%20first%20two%20of%20the%20full%20fdtd()%20function.%0A%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20fresnelLoss(materialIndex1%2C%20crystalTheta1%2C%20crystalPhi1%2C%20materialIndex2%2C%20crystalTheta2%2C%20crystalPhi2)%0A%20%20%20%20%20%20%20%20This%20function%20will%20apply%20the%20Fresnel%20loss%20associated%20with%20transmission%20through%20the%20interface%20between%20the%20media%20determined%20by%20materialIndex1%20and%20materialIndex2.%20The%20first%20material%20is%20the%20material%20from%20which%20the%20beam%20is%20incident%2C%20and%20the%20second%20is%20the%20new%20medium%20the%20beam%20is%20entering.%0A%0A%20%20%20%20%20%20%20%20This%20function%20is%20currently%20not%20working!%20It%20will%20do%20nothing%20if%20you%20apply%20it.%0A%0A%20%20%20%20%20%20%20%20This%20function%20will%20*not*%20initialize%20the%20grid%20-%20it%20is%20necessary%20to%20precede%20it%20with%20one%20that%20does.%0A%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20sphericalMirror(radiusOfCurvature)%0A%20%20%20%20%20%20%20%20This%20will%20apply%20a%20radial%20phase%20associated%20with%20reflection%20from%20a%20spherical%20mirror.%20The%20radiusOfCurvature%20parameter%20sets%20the%20radius%20(and%20thus%20focal%20length%20x%202)%20in%20meters.%0A%0A%20%20%20%20%20%20%20%20This%20function%20will%20*not*%20initialize%20the%20grid%20-%20it%20is%20necessary%20to%20precede%20it%20with%20one%20that%20does.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20parabolicMirror(focalLength)%0A%20%20%20%20%20%20%20%20This%20will%20apply%20a%20spatial%20phase%20associated%20with%20reflection%20(on-axis)%20from%20a%20parabolic%20mirror.%20focalLength%20is%20the%20focal%20length%20in%20meters.%0A%0A%20%20%20%20%20%20%20%20This%20function%20will%20*not*%20initialize%20the%20grid%20-%20it%20is%20necessary%20to%20precede%20it%20with%20one%20that%20does.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20aperture(diameter%2C%20activationParameter)%0A%20%20%20%20%20%20%20%20This%20function%20applies%20an%20aperture%20to%20the%20field.%20The%20diameter%20parameter%20gives%20the%20diameter%20of%20the%20opening%20in%20meters.%20The%20activationParameter%20determines%20how%20%22soft%22%20the%20aperture%20is.%20For%20an%20activation%20function%20%24p%24%2C%20it%20takes%20the%20form%3A%0A%0A%20%20%20%20%20%20%20%20%241%20-%20%5Cfrac%7B1%7D%7B1%20%2B%20%5Cexp%7B%5Cleft(-p(r-r_o)%5Cright)%7D%7D%24%0A%0A%20%20%20%20%20%20%20%20This%20function%20will%20*not*%20initialize%20the%20grid%20-%20it%20is%20necessary%20to%20precede%20it%20with%20one%20that%20does.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%20farFieldAperture(openingAngle%2C%20activationParameter%2C%20alphaX%2C%20alphaY)%0A%20%20%20%20%20%20%20%20This%20applies%20an%20aperture%20in%20the%20far%20field.%20Conceptually%20this%20is%20somewhat%20different%20than%20the%20elements%20as%20it%20doesn't%20correspond%20to%20an%20actual%20thin%20optic%20you%20can%20place%20in%20your%20beam.%20It%20essentially%20provides%20the%20effect%20of%20allowing%20the%20field%20to%20propagate%20into%20the%20far%20field%2C%20and%20selecting%20a%20conical%20section%20of%20the%20light%20determined%20by%20the%20angles%20openingAngle%20(e.g.%20the%20apex%20angle%20of%20the%20cone)%20and%20the%20two%20angles%20alphaX%20and%20alphaY%20which%20give%20its%20orientation%20relative%20to%20the%20propagation%20axis.%20In%20other%20words%2C%20you%20place%20an%20aperture%20far%20away%20from%20the%20starting%20position%20of%20the%20field%2C%20propagate%20through%20it%2C%20and%20then%20image%20the%20field%20back%20to%20the%20starting%20point.%0A%0A%20%20%20%20%20%20%20%20The%20activation%20parameter%20sets%20the%20softness%20of%20the%20edges%20of%20the%20cone%20using%20the%20same%20sigmoid%20function%20defined%20for%20the%20aperture()%20function.%0A%0A%20%20%20%20%20%20%20%20*NOTE%3A%20This%20function%20only%20gives%20quantitatively%20correct%20results%20in%203D%20mode%20at%20the%20moment%20-%20for%20the%20other%20modes%20I%20will%20fix%20it%2C%20but%20right%20now%20consider%20its%20effects%20to%20be%20qualitative-only!*%0A%0A%20%20%20%20%20%20%20%20This%20function%20will%20*not*%20initialize%20the%20grid%20-%20it%20is%20necessary%20to%20precede%20it%20with%20one%20that%20does.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%20filter(f0%2C%20bandwidth%2C%20order%2C%20inBandAmplitude%2C%20outOfBandAmplitude)%0A%20%20%20%20%20%20%20%20This%20applies%20a%20frequency%20filter%20to%20the%20field%2C%20of%20the%20form%3A%0A%0A%20%20%20%20%20%20%20%20%24F(f)%20%3D%20%5Cmathrm%7BoutOfBandAmplitude%7D%20%2B%20%5Cmathrm%7BinBandAmplitude%7D%20%5Ctimes%20e%5E%7B-(f-f_0)%5E%7B%5Cmathrm%7Border%7D%7D%2F(2%5Ctimes%20%5Cmathrm%7Bbandwidth%7D%5E%5Cmathrm%7Border%7D)%7D%24%0A%0A%20%20%20%20%20%20%20%20e.g.%20with%20order%204%2C%20when%20outOfBandAmplitude%20is%200%20and%20inBandAmplitude%20is%201%2C%20it%20becomes%20a%20supergaussian%20bandpass%20filter%20around%20f0.%20%0A%0A%20%20%20%20%20%20%20%20If%20outOfBandAmplitude%20is%201%20and%20inBandAmplitude%20is%20-1%2C%20it%20is%20a%20bandstop%20filter.%0A%0A%20%20%20%20%20%20%20%20If%20outOfBandAmplitude%20is%201%20and%20inBandAmplitude%20is%202%2C%20it%20will%20apply%20a%20gain%20of%203%20in%20the%20pass%20band.%0A%0A%20%20%20%20%20%20%20%20f0%20and%20bandwidth%20are%20in%20units%20of%20THz.%0A%0A%20%20%20%20%20%20%20%20Filters%20applied%20by%20this%20function%20do%20not%20modify%20the%20phase%20of%20the%20field%2C%20and%20thus%20do%20not%20obey%20causality.%20A%20real%20filter%20will%20distort%20the%20spectral%20phase%2C%20so%20think%20of%20any%20subsequent%20interactions%20as%20taking%20place%20in%20the%20best-case%20scenario%20concerning%20pulse%20distortions.%0A%0A%20%20%20%20%20%20%20%20This%20function%20will%20*not*%20initialize%20the%20grid%20-%20it%20is%20necessary%20to%20precede%20it%20with%20one%20that%20does.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20set(variableIndex%2C%20value)%0A%20%20%20%20%20%20%20%20This%20will%20set%20the%20variable%20determined%20by%20variableIndex%20(e.g.%20variableIndex%3D0%20will%20set%20the%20value%20of%20v0)%20to%20have%20a%20value%20of%20%22value%22.%0A%0A%20%20%20%20%20%20%20%20This%20function%20will%20*not*%20initialize%20the%20grid%2C%20but%20it%20doesn't%20care%20if%20the%20grid%20is%20already%20initialized%20or%20not%2C%20and%20will%20work%20either%20way.%0A%0A%20%20%20%20%20%20%20%20%23%23%23%20energy(variableIndex%2C%20type)%0A%20%20%20%20%20%20%20%20This%20function%20will%20put%20the%20energy%20contained%20in%20the%20field%20into%20the%20variable%20determined%20by%20variableIndex.%20The%20type%20says%20whether%20you%20want%20just%20the%20energy%20on%20the%20x-axis%20(0)%2C%20or%20on%20the%20y-axis(1)%2C%20or%20all%20of%20the%20energy%20(2).%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20for(N%2C%20variableIndex)%0A%20%20%20%20%20%20%20%20This%20allows%20you%20to%20make%20a%20for%20loop%20with%20N%20iterations.%20The%20current%20iterator%20value%20is%20stored%20in%20the%20variable%20corresponding%20to%20variableIndex%0A%0A%20%20%20%20%20%20%20%20for(10%2C1)%7B...%7D%20will%20do%20whatever%20...%20is%2010%20times%2C%20while%20counting%20from%200%20to%209%20in%20v1.%0A%0A%0A%20%20%20%20%20%20%20%20%23%23%23%23%20%3C%3E%20(Angle%20brackets)%0A%20%20%20%20%20%20%20%20These%20don't%20act%20as%20a%20function%2C%20but%20they%20allow%20you%20to%20disable%20a%20segment%20of%20code%20while%20leaving%20it%20intact%2C%20or%20add%20comments.%20They%20are%20similar%20to%20%2F*%20*%2F%20in%20c%2B%2B.%20for%20example%3A%0A%20%20%20%20%20%20%20%20~~~%0A%20%20%20%20%20%20%20%20%20%20%20%20default()%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CThe%20functions%20below%20will%20not%20run%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Crotate(90)%0A%20%20%20%20%20%20%20%20%20%20%20%20sphericalMirror(1)%3E%0A%20%20%20%20%20%20%20%20~~~%0A%20%20%20%20%20%20%20%20This%20code%20will%20just%20run%20default().%20(Note%2C%20if%20you%20only%20see%20%22default()%22%20in%20the%20above%20block%2C%20there's%20something%20funky%20with%20how%20angle%20brackets%20are%20being%20displayed...)%20If%20the%20braces%20around%20the%20rotation%20and%20spherical%20mirror%20functions%20are%20removed%2C%20they%20will%20also%20be%20applied.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%23%23%20Fitting%20mode%0A%0A%20%20%20%20%20%20%20%20The%20fitting%20mode%20allows%20for%20automatic%20adjustment%20of%20the%20light%2Fcrystal%20parameters%20in%20order%20to%20either%20maximize%20the%20power%20in%20a%20given%20spectral%20band%2C%20or%20to%20match%20the%20spectrum%20of%20an%20input%20reference%20in%20that%20band.%0A%0A%20%20%20%20%20%20%20%20A%20fitting%20command%20has%20the%20form%3A%0A%20%20%20%20%20%20%20%20%60%60%60%0A%20%20%20%20%20%20%20%20%5Bbeginning%20of%20ROI%2C%20Hz%5D%20%5Bend%20of%20ROI%2C%20Hz%5D%20%5BMax%20iterations%5D%3B%0A%20%20%20%20%20%20%20%20%5BParameter%20index1%5D%20%5Bmin1%5D%20%5Bmax1%5D%3B%20%5Bparameter%20index2%5D%20%5Bmin2%5D%20%5Bmax2%5D...%0A%20%20%20%20%20%20%20%20%60%60%60%0A%20%20%20%20%20%20%20%20For%20example%2C%20if%20you%20set%20it%20to%20%22Maximize%20x%22%20in%20the%20pull-down%20menu%2C%20the%20command%0A%20%20%20%20%20%20%20%20%60%60%60%0A%20%20%20%20%20%20%20%20100e12%20200e12%201000%3B%0A%20%20%20%20%20%20%20%2029%200%2090%3B%0A%20%20%20%20%20%20%20%2030%200%20180%3B%0A%20%20%20%20%20%20%20%20%60%60%60%0A%20%20%20%20%20%20%20%20will%20do%20the%20following%3A%20do%20at%20most%201000%20calculations%2C%20trying%20to%20maximize%20the%20intensity%20in%20the%20range%20from%20100%20THz%20to%20200%20THz%2C%20by%20adjusting%20the%20crystal%20angles%20%24%5Ctheta%24%20and%20%24%5Cphi%24%2C%20over%20the%20full%20range%20of%20values.%20The%20units%20should%20be%20in%20the%20same%20units%20as%20the%20rest%20of%20the%20interface.%0A%0A%20%20%20%20%20%20%20%20Fitting%20is%20done%20with%20a%20global%20optimization%2C%20and%20does%20not%20depend%20on%20the%20initial%20values%20of%20the%20search%20parameters%2C%20only%20the%20ranges.%20Smaller%20ranges%20will%20lead%20to%20faster%20convergence.%0A%0A%20%20%20%20%20%20%20%20The%20numbers%20corresponding%20to%20the%20parameters%20are%20the%20same%20as%20those%20assigned%20to%20the%20different%20batch%20modes%3A%20you%20can%20see%20them%20all%20in%20the%20batch%20pull-down%20menus.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%23%23%20File%20formats%0A%0A%20%20%20%20%20%20%20%20When%20you%20run%20a%20simulation%2C%20with%20the%20name%20simulationName%20in%20the%20path%20textbox%20(above%20the%20plots)%2C%20it%20will%20automatically%20save%20the%20results%20when%20it%20finishes%2C%20creating%20several%20files%3A%0A%20%20%20%20%20%20%20%201.%20simulationName.txt%20%3A%20a%20text%20file%20containing%20all%20of%20the%20parameters%20of%20the%20simulation.%20You%20can%20load%20these%20files%20using%20the%20load%20button%2C%20and%20all%20the%20parameters%20will%20be%20entered%20into%20the%20interface%20automatically.%20If%20you%20rename%20it%20to%20%22DefaultValues.ini%22%20and%20put%20it%20in%20the%20same%20folder%20as%20the%20LightwaveExplorer.exe%20file%2C%20those%20values%20will%20be%20automatically%20put%20in%20when%20the%20program%20starts.%0A%20%20%20%20%20%20%20%202.%20simulationName_Ext.dat%20%3A%20a%20binary%20file%20(double%20precision)%20containing%20the%20entire%20electric%20field%20grid.%0A%20%20%20%20%20%20%20%203.%20simulationName_spectrum.dat%3A%20a%20binary%20file%20containing%20the%20integrated%20spectra%20at%20the%20end%20of%20the%20simulation%0A%20%20%20%20%20%20%20%204.%20simulationName.py%20%3A%20a%20python%20code%20snippet%20that%20will%20load%20the%20binary%20files%20and%20give%20them%20the%20proper%20shape%0A%0A%20%20%20%20%20%20%20%20Note%20that%20the%20best%20way%20to%20load%20these%20results%20is%20not%20to%20use%20the%20.py%20or%20.m%20files%2C%20they%20are%20just%20there%20as%20a%20backup%20in%20case%20you%20can't%20open%20them%20any%20other%20way.%20The%20best%20way%20is%20to%20use%20the%20python%20lightwaveExplorer%20module%3A%0A%20%20%20%20%20%20%20%20%60%60%60%0A%20%20%20%20%20%20%20%20import%20lightwaveExplorer%20as%20lwe%0A%20%20%20%20%20%20%20%20s%20%3D%20lwe.load(%22simulationName.txt%22)%0A%20%20%20%20%20%20%20%20%60%60%60%0A%20%20%20%20%20%20%20%20will%20create%20the%20object%20s%2C%20whose%20members%20contain%20all%20of%20the%20results%20and%20parameters%2C%20as%20well%20as%20vectors%20giving%20the%20axes%20of%20the%20grid%2C%20spectra%2C%20and%20any%20batch%20scans%20you%20performed.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%23%23%20Python%20interface%0A%0A%20%20%20%20%20%20%20%20There%20is%20a%20python%20module%2C%20LightwaveExplorer%2C%20that%20makes%20interacting%20with%20the%20results%20easier.%20You%20can%20install%20it%20with%0A%20%20%20%20%20%20%20%20%60%60%60%0A%20%20%20%20%20%20%20%20pip%20install%20LightwaveExplorer%0A%20%20%20%20%20%20%20%20%60%60%60%0A%20%20%20%20%20%20%20%20It%20has%20functions%20to%20load%20the%20results%20of%20a%20simulation%20(.load())%2C%20as%20well%20as%20different%20processing%20methods%2C%20and%20support%20functions.%0A%0A%20%20%20%20%20%20%20%20The%20most%20important%20function%20to%20know%20is%20%22load()%22.%20You%20can%20load%20a%20saved%20result%20by%20providing%20it%20the%20name%20of%20the%20associated%20text%20file.%20For%20example%20%22LWE_result%20%3D%20lwe.load(%22MyResult.txt%22)%22%20will%20give%20you%20an%20object%20containing%20the%20results%20and%20input%20parameters%20of%20the%20simulation.%0A%0A%20%20%20%20%20%20%20%20The%20important%20member%20values%20to%20know%20for%20interpreting%20data%20are%3A%0A%0A%20%20%20%20%20%20%20%20%20-%20.Ext_x%20and%20.Ext_y%3A%20the%20electric%20field%20as%20a%20function%20of%20space%20and%20time%2C%20for%20the%20x%20and%20y%20polarizations%0A%20%20%20%20%20%20%20%20%20-%20.spectrum_x%20and%20.spectrum_y%3A%20The%20polarization-resolved%20integrated%20spectra%20of%20the%20results%0A%20%20%20%20%20%20%20%20%20-%20.spectrumTotal%3A%20The%20spectrum%20of%20all%20the%20resulting%20light%20(just%20the%20sum%20of%20the%20last%20two)%0A%20%20%20%20%20%20%20%20%20-%20.timeVector%3A%20an%20array%20of%20the%20time%20values%20(e.g.%20time-axis%20of%20Ext_x)%0A%20%20%20%20%20%20%20%20%20-%20.spaceVector%3A%20array%20of%20the%20x%2C%20y%2Cor%20r%20spatial%20values%0A%20%20%20%20%20%20%20%20%20-%20.frequencyVectorSpectrum%3A%20an%20array%20giving%20the%20frequencies%20corresponding%20to%20the%20spectra%20arrays%0A%20%20%20%20%20%20%20%20%20-%20.batchVector%3A%20an%20array%20of%20the%20values%20of%20the%20scanned%20parameter%20in%20the%20batch%20mode.%20That%20is%2C%20if%20you%20scanned%20the%20z-offset%20of%20a%20beam%20from%20-2%20to%202%20in%205%20steps%2C%20it%20will%20contain%20%5B-2%2C-1%2C0%2C1%2C2%5D.%0A%0A%20%20%20%20%20%20%20%20If%20you're%20using%20an%20editor%20that%20gives%20you%20autocomplete%2C%20that's%20probably%20the%20easiest%20way%20to%20find%20the%20rest%3B%20you%20also%20have%20all%20of%20your%20input%20parameters%2C%20like%20.pulseEnergy1%20and%20so%20on.%0A%0A%20%20%20%20%20%20%20%20The%20LightwaveExplorer%20module%20(which%20I%20load%20as%20%22import%20LightwavExplorer%20as%20lwe%22%20above)%2C%20also%20contains%20some%20helper%20functions%20that%20I'll%20describe%20in%20more%20detail%20soon.%20These%20include%3A%0A%20%20%20%20%20%20%20%20%20-%20sellmeier()%3A%20a%20copy%20of%20the%20sellmeier%20equations%20used%20inside%20the%20simulation%2C%20so%20you%20can%20give%20it%20the%20same%20array%20of%20parameters%20and%20plot%20the%20corresponding%20refractive%20index%20(useful%20when%20making%20new%20entries%20in%20the%20crystal%20database)%0A%20%20%20%20%20%20%20%20%20-%20getSellmeierFromRII()%3A%20you%20can%20give%20this%20function%20a%20link%20to%20the%20YAML%20file%20labeled%20%22Full%20database%20record%22%20on%20the%20site%20refractiveindex.info%2C%20and%20it%20will%20return%20an%20array%20of%20the%20associated%20Sellmeier%20coefficients%20in%20an%20array%20that%20can%20be%20used%20by%20lwe.sellmeier()%20or%20pasted%20into%20the%20CrystalDatabase.txt.%0A%20%20%20%20%20%20%20%20%20-%20getTabulatedDataFromRII()%3A%20If%20the%20data%20on%20refractiveindex.info%20contains%20tabulated%20n%20and%20k%20values%2C%20this%20will%20retrieve%20those%20in%20a%20numpy%20array%20(first%20column%20wavelength%2C%20then%20n%2C%20then%20k)%0A%20%20%20%20%20%20%20%20%20-%20sellmeierFit()%3A%20from%20a%20tabulated%20set%20of%20n%20and%20k%20vs.%20wavelength%2C%20fit%20the%20parameters%20of%20a%20Sellmeier%20equation%20to%20them.%20I%20will%20post%20an%20example%20notebook%20of%20how%20to%20do%20this%20soon!%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20return%20(mo%2C)%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A</marimo-code></head>
  <body>
    <div id="root"></div>
  </body>
</html>
